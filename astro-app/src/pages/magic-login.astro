---
import BaseLayout from '@/layouts/BaseLayout.astro';
import MagicLoginHandler from '@/components/react/MagicLoginHandler';

// Utilisation des valeurs par défaut si les variables d'environnement ne sont pas définies
const SUPABASE_URL = import.meta.env.PUBLIC_SUPABASE_URL || 'https://dcwfgxbwpecnjbhrhrib.supabase.co';
const SUPABASE_ANON_KEY = import.meta.env.PUBLIC_SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRjd2ZneGJ3cGVjbmpiaHJocmliIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjU5MjA4ODAsImV4cCI6MjA0MTQ5Njg4MH0.YA6bCcTMwrzX8tEOlIq2xKVPGdXLJEPdGrGNDL_7g6g';

// Get token from URL
const url = new URL(Astro.request.url);
const token = url.searchParams.get('token');
---

<BaseLayout
  title="Connexion magique - ChatFood"
  description="Validation de votre lien de connexion ChatFood"
  canonical="/magic-login"
>
  <MagicLoginHandler 
    client:load 
    supabaseUrl={SUPABASE_URL}
    supabaseAnonKey={SUPABASE_ANON_KEY}
    token={token}
  />
</BaseLayout>
