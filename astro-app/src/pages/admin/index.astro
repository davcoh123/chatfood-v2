---
import AdminLayout from '@/layouts/AdminLayout.astro';
import { DashboardRoot } from '@/components/react/providers/DashboardRoot';
import AdminDashboardPage from '@/components/react/admin/AdminDashboardPage';

// Get user, session, profile from middleware locals
const user = (Astro.locals as any).user;
const session = (Astro.locals as any).session;
const profile = (Astro.locals as any).profile;

if (!user) {
  return Astro.redirect('/login?redirect=/admin');
}

if (user.role !== 'admin') {
  return Astro.redirect('/dashboard');
}
---

<AdminLayout title="Administration">
  <DashboardRoot client:only="react" user={user} session={session} profile={profile}>
    <AdminDashboardPage />
  </DashboardRoot>
</AdminLayout>
