---
import '@/styles/global.css';
import DashboardLayout from '@/layouts/DashboardLayout.astro';
import { DashboardPage } from '@/components/react/DashboardPage';

// Get user from middleware locals
const user = (Astro.locals as any).user;

if (!user) {
  return Astro.redirect('/login');
}

// Redirect admin users to admin dashboard
if (user.role === 'admin') {
  return Astro.redirect('/admin');
}

// Redirect to onboarding if not completed
if (!user.onboarding_completed) {
  return Astro.redirect('/onboarding');
}

// Map user plan to type
const plan = (user.plan || 'starter') as 'starter' | 'pro' | 'premium';
---

<DashboardLayout title="Tableau de bord">
  <DashboardPage 
    client:only="react"
    userId={user.id} 
    firstName={user.first_name || 'Restaurateur'}
    plan={plan}
    onboardingCompleted={user.onboarding_completed || false}
  />
</DashboardLayout>
