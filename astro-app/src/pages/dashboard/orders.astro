---
import DashboardLayout from '@/layouts/DashboardLayout.astro';
import { createServerClient } from '@/lib/supabase';

// Auth check
const supabase = createServerClient(Astro.cookies);
const { data: { user } } = await supabase.auth.getUser();

if (!user) {
  return Astro.redirect('/login?redirect=/dashboard/orders');
}
---

<DashboardLayout title="Commandes">
  <div class="space-y-6">
    <div>
      <h1 class="text-2xl md:text-3xl font-bold">Commandes</h1>
      <p class="text-gray-500 mt-2">
        GÃ©rez vos commandes
      </p>
    </div>
    
    <div id="orders-panel" data-user-id={user.id}></div>
  </div>
</DashboardLayout>

<script>
  import React from 'react';
  import ReactDOM from 'react-dom/client';
  import { OrdersPanel } from '@/components/dashboard/OrdersPanel';

  const container = document.getElementById('orders-panel');
  if (container) {
    const userId = container.dataset.userId;
    const root = ReactDOM.createRoot(container);
    root.render(React.createElement(OrdersPanel, { userId }));
  }
</script>
