---
import DashboardLayout from '@/layouts/DashboardLayout.astro';
import { createServerClient } from '@/lib/supabase';
import SettingsPage from '@/components/react/SettingsPage';

// Auth check
const supabase = createServerClient(Astro.cookies);
const { data: { user } } = await supabase.auth.getUser();

if (!user) {
  return Astro.redirect('/login?redirect=/dashboard/settings');
}

// Get profile
const { data: profile } = await supabase
  .from('profiles')
  .select('first_name, last_name, email')
  .eq('user_id', user.id)
  .single();
---

<DashboardLayout title="Paramètres">
  <div class="space-y-6">
    <div>
      <h1 class="text-2xl md:text-3xl font-bold">Paramètres</h1>
      <p class="text-gray-500 mt-2">
        Configurez votre restaurant et votre compte
      </p>
    </div>
    
    <SettingsPage 
      client:only="react" 
      userId={user.id}
      userEmail={user.email || ''}
      firstName={profile?.first_name || ''}
      lastName={profile?.last_name || ''}
    />
  </div>
</DashboardLayout>
