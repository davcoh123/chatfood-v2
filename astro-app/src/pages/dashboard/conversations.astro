---
import DashboardLayout from '@/layouts/DashboardLayout.astro';
import { createServerClient } from '@/lib/supabase';
import { ConversationsWidget } from '@/components/dashboard/ConversationsWidget';

// Auth check
const supabase = createServerClient(Astro.cookies);
const { data: { user } } = await supabase.auth.getUser();

if (!user) {
  return Astro.redirect('/login?redirect=/dashboard/conversations');
}
---

<DashboardLayout title="Conversations WhatsApp">
  <div class="space-y-6">
    <div>
      <h1 class="text-2xl md:text-3xl font-bold">Conversations WhatsApp</h1>
      <p class="text-gray-500 mt-2">
        Gérez vos conversations WhatsApp avec vos clients en temps réel
      </p>
    </div>
    
    <div id="conversations-widget" data-section-id="conversations"></div>
  </div>
</DashboardLayout>

<script>
  import React from 'react';
  import ReactDOM from 'react-dom/client';
  import { ConversationsWidget } from '@/components/dashboard/ConversationsWidget';

  const container = document.getElementById('conversations-widget');
  if (container) {
    const sectionId = container.dataset.sectionId;
    const root = ReactDOM.createRoot(container);
    root.render(React.createElement(ConversationsWidget, { sectionId }));
  }
</script>
