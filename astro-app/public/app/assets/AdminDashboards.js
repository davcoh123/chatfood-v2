import{r as c,F as ie,l as oe,j as e,D as de,n as me,o as he,p as ue,q as pe,I as T,t as xe,B as q,s as W,C as w,a as _,b as k,g as f,c as R,m as D,T as G,U as K,ak as U,f as le,al as je,e as ne}from"./index.js";import{u as $}from"./useQuery.js";import{S as ve,a as be,b as ye,c as ge,d as we}from"./select.js";import{D as _e,R as ke}from"./ReservationsCalendar.js";import{C as fe}from"./ConversationsWidget.js";import{L as N}from"./label.js";import{L as E}from"./loader-circle.js";import{S as Ne}from"./switch.js";import{C as Se}from"./circle-check-big.js";import{C as Te}from"./shopping-bag.js";import{A as Ae,a as Re}from"./alert.js";import{T as Ee,a as De,b as H,c as Z}from"./tabs.js";import qe from"./Catalogue.js";import{C as A}from"./calendar.js";import{S as B}from"./star.js";import{M as F}from"./message-square.js";import{E as We}from"./eye.js";import"./index4.js";import"./index3.js";import"./index5.js";import"./check.js";import"./activity.js";import"./leaf.js";import"./arrow-left.js";import"./user-cog.js";import"./truck.js";import"./user.js";import"./euro.js";import"./circle-alert.js";import"./circle-check.js";import"./clock.js";import"./info.js";import"./copy.js";import"./database.js";import"./download.js";import"./external-link.js";import"./unplug.js";import"./file-spreadsheet.js";import"./file-text.js";import"./pencil.js";import"./heart.js";import"./lightbulb.js";import"./list.js";import"./mail.js";import"./map-pin.js";import"./phone.js";import"./plus.js";import"./rotate-ccw.js";import"./zoom-out.js";import"./save.js";import"./search.js";import"./send.js";import"./store.js";import"./trash-2.js";import"./triangle-alert.js";import"./trophy.js";import"./upload.js";import"./user-plus.js";import"./isPlainObject.js";import"./useRestaurantSettings.js";import"./fr.js";import"./index2.js";import"./useCatalogue.js";import"./CatalogueCreator.js";import"./textarea.js";import"./scroll-area.js";import"./table.js";import"./sortable.esm.js";import"./ConfirmDialog.js";import"./alert-dialog.js";import"./popover.js";function ze({open:r,onOpenChange:i,userId:o,sectionId:v,sectionType:s,plan:x,currentConfig:t,isActive:b=!0,onSave:p}){const[d,y]=c.useState((t==null?void 0:t.title)||""),[l,h]=c.useState((t==null?void 0:t.webhook_url)||""),[g,z]=c.useState(!1),{toast:L}=ie(),n=oe();c.useEffect(()=>{r&&(y((t==null?void 0:t.title)||""),h((t==null?void 0:t.webhook_url)||""))},[r,o,v,t==null?void 0:t.title,t==null?void 0:t.webhook_url]);const j=async()=>{z(!0);try{const m={title:d||void 0,webhook_url:l||void 0},{error:S}=await W.from("dashboard_configurations").upsert({user_id:o,section_id:v,section_type:s,plan:x,customizations:m,is_active:!0},{onConflict:"user_id,section_id"});if(S)throw S;n.invalidateQueries({queryKey:["dashboard-config"]}),n.invalidateQueries({queryKey:["dashboard-value"]}),n.invalidateQueries({queryKey:["dashboard-configs-all"]}),L({title:"SauvegardÃ©",description:"La configuration a Ã©tÃ© mise Ã  jour"}),p()}catch(m){console.error("Save error:",m),L({title:"Erreur",description:"Impossible de sauvegarder la configuration",variant:"destructive"})}finally{z(!1)}};return e.jsx(de,{open:r,onOpenChange:i,children:e.jsxs(me,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(he,{children:[e.jsxs(ue,{children:["Ã‰diter: ",v]}),e.jsx(pe,{children:"Personnalisez cet indicateur pour l'utilisateur"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"title",children:"Nom"}),e.jsx(T,{id:"title",value:d,onChange:m=>y(m.target.value),placeholder:"Ex: Messages WhatsApp"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"webhook",children:"URL Webhook"}),e.jsx(T,{id:"webhook",value:l,onChange:m=>h(m.target.value),placeholder:"https://hooks.zapier.com/..."})]})]}),e.jsxs(xe,{children:[e.jsx(q,{variant:"outline",onClick:()=>i(!1),disabled:g,children:"Annuler"}),e.jsxs(q,{onClick:j,disabled:g,children:[g&&e.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),"Sauvegarder"]})]})]})})}function te({userId:r,sectionId:i,sectionType:o,plan:v,currentConfig:s,isActive:x=!0,onSave:t}){const[b,p]=c.useState((s==null?void 0:s.title)||""),[d,y]=c.useState(i==="conversations"?(s==null?void 0:s.webhook_url_get)||"":(s==null?void 0:s.webhook_url)||""),[l,h]=c.useState(i==="conversations"?(s==null?void 0:s.webhook_url_post)||"":(s==null?void 0:s.webhook_url_day)||""),[g,z]=c.useState((s==null?void 0:s.webhook_url_week)||""),[L,n]=c.useState((s==null?void 0:s.webhook_url_month)||""),[j,m]=c.useState((s==null?void 0:s.icon)||""),[S,M]=c.useState((s==null?void 0:s.color)||""),[P,a]=c.useState(x),[J,X]=c.useState(!1),[O,Y]=c.useState(!1),[V,Q]=c.useState(null),{toast:I}=ie(),ee=oe(),se=async()=>{if(!d){I({title:"Erreur",description:"Veuillez entrer une URL de webhook",variant:"destructive"});return}Y(!0),Q(null);try{const C=await(await fetch(d,{method:"GET",headers:{"Content-Type":"application/json"}})).json();Q(JSON.stringify(C,null,2)),I({title:"Test rÃ©ussi",description:"Le webhook a rÃ©pondu correctement"})}catch(u){console.error("Webhook test error:",u),I({title:"Erreur",description:"Le webhook n'a pas rÃ©pondu",variant:"destructive"}),Q("Erreur: Le webhook n'a pas rÃ©pondu")}finally{Y(!1)}},ce=async()=>{X(!0);try{const u=i==="reservations_calendar"?{}:i==="conversations"?{webhook_url_get:d||void 0,webhook_url_post:l||void 0,refresh_interval:120}:{title:b||void 0,webhook_url:d||void 0,icon:j||void 0,color:S||void 0},{error:C}=await W.from("dashboard_configurations").upsert({user_id:r,section_id:i,section_type:o,plan:v,customizations:u,is_active:P},{onConflict:"user_id,section_id"});if(C)throw C;ee.invalidateQueries({queryKey:["dashboard-config"]}),ee.invalidateQueries({queryKey:["dashboard-value"]}),I({title:"SauvegardÃ©",description:"La configuration a Ã©tÃ© mise Ã  jour"}),t==null||t()}catch(u){console.error("Save error:",u),I({title:"Erreur",description:"Impossible de sauvegarder la configuration",variant:"destructive"})}finally{X(!1)}};return e.jsxs(w,{children:[e.jsxs(_,{children:[e.jsxs(k,{children:["Configuration: ",i]}),e.jsx(f,{children:"Personnalisez cet indicateur pour l'utilisateur"})]}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(N,{htmlFor:"active",children:"Actif"}),e.jsx(Ne,{id:"active",checked:P,onCheckedChange:a})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"title",children:"Titre personnalisÃ©"}),e.jsx(T,{id:"title",value:b,onChange:u=>p(u.target.value),placeholder:"Laissez vide pour le titre par dÃ©faut"})]}),i==="reservations_calendar"?e.jsxs("div",{className:"mt-4 p-4 border rounded-lg bg-muted/50",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"ðŸ“… Webhook HardcodÃ©"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Le webhook de rÃ©servations est configurÃ© automatiquement :"}),e.jsx("code",{className:"text-xs bg-background p-2 rounded block break-all",children:"https://n8n.chatfood.fr/webhook/full-reservations-mois-chatfood-demo"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"ðŸ’¡ Ce webhook unique gÃ¨re toutes les vues (jour, semaine, mois)"})]}):i==="conversations"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"webhook-get",children:"Webhook GET (RÃ©cupÃ©ration messages)"}),e.jsx(T,{id:"webhook-get",value:d,onChange:u=>y(u.target.value),placeholder:"https://n8n.example.com/webhook/messages"}),e.jsxs(q,{type:"button",variant:"outline",size:"sm",onClick:se,disabled:!d||O,children:[O&&e.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),"Tester GET"]}),V&&e.jsx("pre",{className:"mt-2 rounded-md bg-muted p-2 text-xs overflow-auto max-h-32",children:V})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"webhook-post",children:"Webhook POST (Envoi rÃ©ponses)"}),e.jsx(T,{id:"webhook-post",value:l,onChange:u=>h(u.target.value),placeholder:"https://n8n.example.com/webhook/send"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"refresh",children:"Intervalle de rafraÃ®chissement (secondes)"}),e.jsx(T,{id:"refresh",type:"number",value:120,disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"FixÃ© Ã  2 minutes (120 secondes)"})]}),e.jsxs("div",{className:"mt-4 p-4 border rounded-lg bg-muted/50",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"ðŸ“± PrÃ©visualisation"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"L'interface affichera les conversations en temps rÃ©el avec :"}),e.jsxs("ul",{className:"text-sm space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Panel latÃ©ral avec liste des clients"}),e.jsx("li",{children:"Zone de messages style WhatsApp"}),e.jsx("li",{children:"Champ de rÃ©ponse en bas"}),e.jsx("li",{children:"RafraÃ®chissement automatique toutes les 2 min"})]})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"webhook",children:"URL Webhook Zapier"}),e.jsx(T,{id:"webhook",value:d,onChange:u=>y(u.target.value),placeholder:"https://hooks.zapier.com/..."}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(q,{type:"button",variant:"outline",size:"sm",onClick:se,disabled:!d||O,children:[O&&e.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),"Tester"]})}),V&&e.jsx("pre",{className:"mt-2 rounded-md bg-muted p-2 text-xs overflow-auto max-h-32",children:V})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"icon",children:"IcÃ´ne (nom Lucide)"}),e.jsx(T,{id:"icon",value:j,onChange:u=>m(u.target.value),placeholder:"TrendingUp, Calendar, etc."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"color",children:"Couleur (classe Tailwind)"}),e.jsx(T,{id:"color",value:S,onChange:u=>M(u.target.value),placeholder:"text-primary, text-green-600, etc."})]}),e.jsxs(q,{onClick:ce,disabled:J,className:"w-full",children:[J&&e.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),"Sauvegarder"]})]})]})}function Le({userId:r,userName:i,existingConfig:o,onSave:v}){const[s,x]=c.useState((o==null?void 0:o.webhook_url_get)||""),[t,b]=c.useState((o==null?void 0:o.webhook_url_post)||""),[p,d]=c.useState(!1),[y,l]=c.useState(null),[h,g]=c.useState(!1),z=async()=>{if(!s){D.error("Veuillez entrer une URL GET");return}d(!0),l(null);try{const n=new AbortController,j=setTimeout(()=>n.abort(),1e4),m=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json"},signal:n.signal});if(clearTimeout(j),m.ok){const S=await m.json();Array.isArray(S)?(l("success"),D.success(`Connexion rÃ©ussie - ${S.length} items rÃ©cupÃ©rÃ©s`)):(l("error"),D.error("Format invalide - Le webhook doit retourner un tableau"))}else l("error"),D.error(`Le webhook a retournÃ©: ${m.status}`)}catch{l("error"),D.error("Impossible de joindre le webhook")}finally{d(!1)}},L=async()=>{if(!s&&!t){D.error("Au moins une URL webhook est requise");return}g(!0);try{const{data:n}=await W.from("dashboard_configurations").select("id").eq("user_id",r).eq("section_id","catalogue").maybeSingle();if(n){const{error:j}=await W.from("dashboard_configurations").update({customizations:{webhook_url_get:s,webhook_url_post:t},updated_at:new Date().toISOString()}).eq("id",n.id);if(j)throw j}else{const{error:j}=await W.from("dashboard_configurations").insert({user_id:r,section_id:"catalogue",section_type:"catalogue",plan:"starter",customizations:{webhook_url_get:s,webhook_url_post:t},is_active:!0});if(j)throw j}D.success(`Configuration sauvegardÃ©e pour ${i}`),v()}catch(n){console.error("Error saving catalogue config:",n),D.error("Impossible de sauvegarder la configuration")}finally{g(!1)}};return e.jsxs(w,{children:[e.jsxs(_,{children:[e.jsx(k,{children:"Configuration du Catalogue"}),e.jsxs(f,{children:["Configurez les webhooks pour le catalogue de ",i]})]}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"webhook-get",children:"Webhook GET (rÃ©cupÃ©ration des items)"}),e.jsx(T,{id:"webhook-get",placeholder:"https://n8n.chatfood.fr/webhook/get-menu-items",value:s,onChange:n=>x(n.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ce webhook doit retourner un tableau d'items au format JSON"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"webhook-post",children:"Webhook POST (sauvegarde des modifications)"}),e.jsx(T,{id:"webhook-post",placeholder:"https://n8n.chatfood.fr/webhook/update-menu-items",value:t,onChange:n=>b(n.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ce webhook recevra les items modifiÃ©s depuis la page Catalogue"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{variant:"outline",onClick:z,disabled:p||!s,children:p?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 animate-spin mr-2"}),"Test en cours..."]}):e.jsxs(e.Fragment,{children:[y==="success"&&e.jsx(Se,{className:"h-4 w-4 mr-2 text-green-600"}),y==="error"&&e.jsx(Te,{className:"h-4 w-4 mr-2 text-red-600"}),"Tester la connexion"]})}),e.jsx(q,{onClick:L,disabled:h||!s&&!t,children:h?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 animate-spin mr-2"}),"Sauvegarde..."]}):"Sauvegarder la configuration"})]})]})]})}const ae={starter:[{id:"whatsapp_messages",type:"metric",title:"Messages WhatsApp",icon:F,color:"text-green-600"},{id:"orders",type:"metric",title:"Nombre de commandes",icon:le,color:"text-orange-600"},{id:"reservations_calendar",type:"calendar",title:"Calendrier de RÃ©servations",icon:A,color:"text-blue-600"},{id:"catalogue",type:"catalogue",title:"Catalogue",icon:U,color:"text-orange-600"}],pro:[{id:"daily_revenue",type:"metric",title:"Revenu journalier",icon:G,color:"text-emerald-600"},{id:"daily_orders",type:"metric",title:"Commandes",icon:A,color:"text-blue-600"},{id:"active_customers",type:"metric",title:"Clients actifs",icon:K,color:"text-purple-600"},{id:"satisfaction",type:"metric",title:"Satisfaction",icon:B,color:"text-yellow-600"},{id:"reservations_calendar",type:"calendar",title:"Calendrier de RÃ©servations",icon:A,color:"text-blue-600"},{id:"catalogue",type:"catalogue",title:"Catalogue",icon:U,color:"text-orange-600"}],premium:[{id:"daily_revenue",type:"metric",title:"Revenu journalier",icon:G,color:"text-emerald-600"},{id:"daily_orders",type:"metric",title:"Commandes",icon:A,color:"text-blue-600"},{id:"active_customers",type:"metric",title:"Clients actifs",icon:K,color:"text-purple-600"},{id:"satisfaction",type:"metric",title:"Satisfaction",icon:B,color:"text-yellow-600"},{id:"reservations_calendar",type:"calendar",title:"Calendrier de RÃ©servations",icon:A,color:"text-blue-600"},{id:"catalogue",type:"catalogue",title:"Catalogue",icon:U,color:"text-orange-600"}]};function Ue({userId:r,plan:i,userName:o,isAdminMode:v=!1,sections:s,configs:x=[],onConfigSave:t}){var S,M,P;const[b,p]=c.useState(null),[d,y]=c.useState(!1),[l,h]=c.useState("dashboard"),g=s||ae[i]||ae.starter,z=g.filter(a=>a.type==="metric"),L=g.filter(a=>a.type==="calendar");g.filter(a=>a.type==="catalogue");const n=x.find(a=>a.section_id==="reservations_calendar"),j=x.find(a=>a.section_id==="catalogue"),m=x.find(a=>a.section_id==="conversations");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Ae,{className:"border-primary/50 bg-primary/5",children:[e.jsx(We,{className:"h-4 w-4"}),e.jsxs(Re,{children:[e.jsx("span",{className:"font-semibold",children:"MODE ADMIN PREVIEW"})," - Vous visualisez le dashboard tel que ",o," le voit"]})]}),e.jsxs(Ee,{value:l,onValueChange:h,className:"w-full",children:[e.jsxs(De,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsxs(H,{value:"dashboard",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Dashboard & MÃ©triques"]}),e.jsxs(H,{value:"catalogue",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Catalogue"]}),e.jsxs(H,{value:"conversations",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Conversations WhatsApp"]})]}),e.jsxs(Z,{value:"dashboard",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold tracking-tight",children:["Bonjour, ",o," ðŸ‘‹"]}),e.jsxs("p",{className:"text-muted-foreground",children:["Voici votre tableau de bord ",i==="starter"?"Starter":i==="pro"?"PRO":"PREMIUM"]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:z.map(a=>e.jsx(_e,{sectionId:a.id,defaultTitle:a.title,defaultIcon:a.icon,defaultColor:a.color,isAdminMode:v,userId:r,onEdit:()=>p(a.id)},a.id))}),b&&e.jsx(ze,{open:!!b,onOpenChange:a=>!a&&p(null),userId:r,sectionId:b,sectionType:((S=g.find(a=>a.id===b))==null?void 0:S.type)||"metric",plan:i,currentConfig:(M=x.find(a=>a.section_id===b))==null?void 0:M.customizations,isActive:((P=x.find(a=>a.section_id===b))==null?void 0:P.is_active)??!0,onSave:()=>{p(null),t==null||t()}}),(i==="pro"||i==="premium")&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Actions rapides"}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(w,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:e.jsxs(_,{children:[e.jsx(k,{className:"text-base",children:"Revenus"}),e.jsx(f,{children:"Analyser les revenus"})]})}),e.jsx(w,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:e.jsxs(_,{children:[e.jsx(k,{className:"text-base",children:"Commandes"}),e.jsx(f,{children:"Voir les commandes"})]})}),e.jsx(w,{className:"cursor-pointer hover:bg-muted/50 transition-colors",children:e.jsxs(_,{children:[e.jsx(k,{className:"text-base",children:"Clients"}),e.jsx(f,{children:"GÃ©rer les clients"})]})})]})]}),i==="premium"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"FonctionnalitÃ©s Premium"}),e.jsxs(w,{children:[e.jsxs(_,{children:[e.jsx(k,{children:"Suggestions IA"}),e.jsx(f,{children:"Recommandations personnalisÃ©es pour optimiser votre activitÃ©"})]}),e.jsx(R,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Les suggestions IA analyseront vos donnÃ©es en temps rÃ©el une fois vos webhooks configurÃ©s."})})]})]}),i==="starter"&&e.jsxs(w,{className:"border-primary/20 bg-gradient-to-br from-primary/5 to-primary/10",children:[e.jsxs(_,{children:[e.jsx(ne,{className:"w-fit mb-2",children:"Upgrade disponible"}),e.jsx(k,{children:"Passez au plan PRO"}),e.jsx(f,{children:"DÃ©bloquez des fonctionnalitÃ©s avancÃ©es pour dÃ©velopper votre activitÃ©"})]}),e.jsx(R,{children:e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsx("li",{children:"âœ… Analytics avancÃ©s (revenus, commandes, clients)"}),e.jsx("li",{children:"âœ… Tableaux de bord personnalisables"}),e.jsx("li",{children:"âœ… Support prioritaire"})]})})]}),L.map(a=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:a.title}),v&&!d&&e.jsx(q,{variant:"outline",size:"sm",onClick:()=>y(!0),children:"Configurer les webhooks"})]}),d?e.jsx(te,{userId:r,sectionId:a.id,sectionType:"calendar",plan:i,currentConfig:(n==null?void 0:n.customizations)||{},isActive:(n==null?void 0:n.is_active)??!0,onSave:()=>{y(!1),t==null||t()}}):e.jsx(ke,{userId:r,isAdminMode:v})]},a.id))]}),e.jsxs(Z,{value:"catalogue",className:"space-y-6",children:[e.jsx(Le,{userId:r,userName:o,existingConfig:j==null?void 0:j.customizations,onSave:()=>t==null?void 0:t()}),e.jsxs(w,{children:[e.jsxs(_,{children:[e.jsx(k,{children:"PrÃ©visualisation du Catalogue"}),e.jsxs(f,{children:["Vous voyez exactement ce que ",o," voit dans son catalogue"]})]}),e.jsx(R,{children:e.jsx(qe,{userId:r})})]})]}),e.jsxs(Z,{value:"conversations",className:"space-y-6",children:[e.jsxs(w,{children:[e.jsxs(_,{children:[e.jsx(k,{children:"Configuration Conversations WhatsApp"}),e.jsxs(f,{children:["Configurez les webhooks pour synchroniser les conversations de ",o]})]}),e.jsx(R,{className:"space-y-4",children:e.jsx(te,{userId:r,sectionId:"conversations",sectionType:"conversations",plan:i,currentConfig:(m==null?void 0:m.customizations)||{},isActive:(m==null?void 0:m.is_active)??!0,onSave:()=>t==null?void 0:t()})})]}),e.jsxs(w,{children:[e.jsxs(_,{children:[e.jsx(k,{children:"PrÃ©visualisation en direct"}),e.jsxs(f,{children:["Vous voyez exactement ce que ",o," voit dans ses conversations"]})]}),e.jsx(R,{children:e.jsx(fe,{userId:r,sectionId:"conversations"})})]})]})]})]})}function Fe({userId:r,userName:i,plan:o,sections:v,configs:s,onConfigSave:x}){return e.jsx(Ue,{userId:r,userName:i,plan:o,isAdminMode:!0,sections:v,configs:s,onConfigSave:x})}const re={starter:[{id:"conversations",title:"Conversations WhatsApp",type:"conversations",icon:F,color:"text-green-600"},{id:"whatsapp_messages",title:"Messages WhatsApp",type:"metric",icon:F,color:"text-green-600"},{id:"orders",title:"Nombre de commandes",type:"metric",icon:le,color:"text-orange-600"},{id:"reservations_calendar",title:"Calendrier de RÃ©servations",type:"calendar",icon:A,color:"text-blue-600"},{id:"catalogue",title:"Catalogue",type:"catalogue",icon:U,color:"text-orange-600"}],pro:[{id:"conversations",title:"Conversations WhatsApp",type:"conversations",icon:F,color:"text-green-600"},{id:"daily_revenue",title:"Revenu du jour",type:"metric",icon:G,color:"text-emerald-600"},{id:"daily_orders",title:"Commandes",type:"metric",icon:A,color:"text-blue-600"},{id:"active_customers",title:"Clients",type:"metric",icon:K,color:"text-purple-600"},{id:"satisfaction",title:"Satisfaction",type:"metric",icon:B,color:"text-yellow-600"},{id:"reservations_calendar",title:"Calendrier de RÃ©servations",type:"calendar",icon:A,color:"text-blue-600"},{id:"catalogue",title:"Catalogue",type:"catalogue",icon:U,color:"text-orange-600"}],premium:[{id:"conversations",title:"Conversations WhatsApp",type:"conversations",icon:F,color:"text-green-600"},{id:"daily_revenue",title:"Revenu Total",type:"metric",icon:G,color:"text-emerald-600"},{id:"daily_orders",title:"Commandes",type:"metric",icon:A,color:"text-blue-600"},{id:"active_customers",title:"Clients Actifs",type:"metric",icon:K,color:"text-purple-600"},{id:"restaurants",title:"Restaurants",type:"metric",icon:B,color:"text-yellow-600"},{id:"reservations_calendar",title:"Calendrier de RÃ©servations",type:"calendar",icon:A,color:"text-blue-600"},{id:"catalogue",title:"Catalogue",type:"catalogue",icon:U,color:"text-orange-600"}]};function st(){const[r,i]=c.useState(""),{data:o,isLoading:v}=$({queryKey:["admin-users-list"],queryFn:async()=>{const{data:l,error:h}=await W.from("profiles").select("user_id, email, first_name, last_name").order("email");if(h)throw h;return l}}),{data:s,isLoading:x}=$({queryKey:["user-plan",r],queryFn:async()=>{if(!r)return null;const{data:l,error:h}=await W.from("user_subscriptions").select("plan").eq("user_id",r).single();if(h)throw h;return l},enabled:!!r}),{data:t,refetch:b}=$({queryKey:["dashboard-configs-all",r],queryFn:async()=>{if(!r)return[];const{data:l,error:h}=await W.from("dashboard_configurations").select("*").eq("user_id",r);if(h)throw h;return l},enabled:!!r}),p=o==null?void 0:o.find(l=>l.user_id===r),d=(s==null?void 0:s.plan)||"starter",y=re[d]||re.starter;return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Gestion des Dashboards"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Personnalisez les dashboards utilisateurs et configurez les webhooks Zapier"})]}),e.jsxs(w,{children:[e.jsxs(_,{children:[e.jsx(k,{children:"SÃ©lectionner un utilisateur"}),e.jsx(f,{children:"Choisissez un utilisateur pour personnaliser son dashboard"})]}),e.jsx(R,{children:v?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Chargement..."})]}):e.jsxs(ve,{value:r,onValueChange:i,children:[e.jsx(be,{children:e.jsx(ye,{placeholder:"SÃ©lectionner un utilisateur"})}),e.jsx(ge,{children:o==null?void 0:o.map(l=>e.jsxs(we,{value:l.user_id,children:[l.email," - ",l.first_name," ",l.last_name]},l.user_id))})]})})]}),p&&e.jsxs(w,{children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(k,{children:[p.first_name," ",p.last_name]}),e.jsx(f,{children:p.email})]}),x?e.jsx(E,{className:"h-4 w-4 animate-spin"}):e.jsx(ne,{className:"uppercase",children:d})]})}),e.jsx(R,{children:x?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(E,{className:"h-8 w-8 animate-spin"})}):e.jsx(Fe,{userId:r,userName:`${p.first_name} ${p.last_name}`,plan:d,sections:y,configs:t||[],onConfigSave:()=>b()})})]})]})}export{st as default};
