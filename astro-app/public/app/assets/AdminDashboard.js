import{r as o,s as a,m as C,U as y,H as m,T as U,j as e,C as i,a as n,b as l,c,g as u}from"./index.js";import{U as w}from"./user-plus.js";import{A as T}from"./activity.js";import{T as x}from"./triangle-alert.js";function q(){const[s,g]=o.useState({totalUsers:0,newUsersThisWeek:0,activeUsers:0,blockedAccounts:0,failedAttemptsToday:0,adminCount:0}),[h,p]=o.useState(!0);o.useEffect(()=>{f()},[]);const f=async()=>{try{const{count:t}=await a.from("profiles").select("*",{count:"exact",head:!0}),r=new Date;r.setDate(r.getDate()-7);const{count:j}=await a.from("profiles").select("*",{count:"exact",head:!0}).gte("created_at",r.toISOString()),{count:v}=await a.from("user_roles").select("*",{count:"exact",head:!0}).eq("role","admin"),{count:N}=await a.from("security_blocks").select("*",{count:"exact",head:!0}).gt("blocked_until",new Date().toISOString()),d=new Date;d.setHours(0,0,0,0);const{count:A}=await a.from("login_attempts").select("*",{count:"exact",head:!0}).eq("success",!1).gte("attempt_time",d.toISOString());g({totalUsers:t||0,newUsersThisWeek:j||0,activeUsers:0,blockedAccounts:N||0,failedAttemptsToday:A||0,adminCount:v||0})}catch(t){console.error("Error fetching admin stats:",t),C.error("Erreur lors du chargement des statistiques")}finally{p(!1)}},b=[{title:"Total Utilisateurs",value:s.totalUsers,description:`dont ${s.adminCount} administrateurs`,icon:y,color:"text-blue-500",bgColor:"bg-blue-500/10"},{title:"Nouveaux Utilisateurs",value:s.newUsersThisWeek,description:"Cette semaine",icon:w,color:"text-green-500",bgColor:"bg-green-500/10"},{title:"Utilisateurs Actifs",value:s.activeUsers,description:"7 derniers jours",icon:T,color:"text-purple-500",bgColor:"bg-purple-500/10"},{title:"Comptes Bloqués",value:s.blockedAccounts,description:"Actuellement",icon:m,color:"text-red-500",bgColor:"bg-red-500/10"},{title:"Tentatives Échouées",value:s.failedAttemptsToday,description:"Aujourd'hui",icon:x,color:"text-orange-500",bgColor:"bg-orange-500/10"},{title:"Taux de Croissance",value:s.totalUsers>0?`+${Math.round(s.newUsersThisWeek/s.totalUsers*100)}%`:"0%",description:"Cette semaine",icon:U,color:"text-cyan-500",bgColor:"bg-cyan-500/10"}];return h?e.jsx("div",{className:"p-8 space-y-8",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/4"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((t,r)=>e.jsx("div",{className:"h-32 bg-muted rounded"},r))})]})}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Dashboard Administrateur"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Vue d'ensemble de la plateforme et des utilisateurs"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:b.map(t=>{const r=t.icon;return e.jsxs(i,{className:"hover:shadow-lg transition-shadow",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(l,{className:"text-sm font-medium",children:t.title}),e.jsx("div",{className:`p-2 rounded-lg ${t.bgColor}`,children:e.jsx(r,{className:`h-4 w-4 ${t.color}`})})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.value}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.description})]})]},t.title)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx(l,{children:"Accès Rapides"}),e.jsx(u,{children:"Actions administrateur fréquentes"})]}),e.jsxs(c,{className:"space-y-2",children:[e.jsxs("a",{href:"/admin/users",className:"block p-4 rounded-lg border hover:bg-muted transition-colors",children:[e.jsx("div",{className:"font-medium",children:"Gestion des Utilisateurs"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Voir, modifier et gérer tous les comptes utilisateurs"})]}),e.jsxs("a",{href:"/admin/security",className:"block p-4 rounded-lg border hover:bg-muted transition-colors",children:[e.jsx("div",{className:"font-medium",children:"Sécurité & Logs"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Consulter les logs de sécurité et les tentatives de connexion"})]}),e.jsxs("a",{href:"/admin/settings",className:"block p-4 rounded-lg border hover:bg-muted transition-colors",children:[e.jsx("div",{className:"font-medium",children:"Paramètres Système"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Configurer les paramètres de la plateforme"})]})]})]}),e.jsxs(i,{children:[e.jsxs(n,{children:[e.jsx(l,{children:"Alertes Récentes"}),e.jsx(u,{children:"Événements nécessitant votre attention"})]}),e.jsxs(c,{children:[s.blockedAccounts>0&&e.jsx("div",{className:"p-4 rounded-lg bg-red-500/10 border border-red-500/20 mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"h-4 w-4 text-red-500"}),e.jsxs("span",{className:"font-medium",children:[s.blockedAccounts," compte(s) bloqué(s)"]})]})}),s.failedAttemptsToday>10&&e.jsx("div",{className:"p-4 rounded-lg bg-orange-500/10 border border-orange-500/20 mb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-4 w-4 text-orange-500"}),e.jsxs("span",{className:"font-medium",children:["Activité suspecte détectée (",s.failedAttemptsToday," tentatives échouées)"]})]})}),s.blockedAccounts===0&&s.failedAttemptsToday<=10&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"Aucune alerte pour le moment. Tout fonctionne normalement."})]})]})]})]})}export{q as default};
