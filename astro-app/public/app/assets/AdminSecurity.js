import{r as m,s as u,m as j,j as e,C as i,a as l,b as d,c as o,H as E,g as N,e as g,B as _}from"./index.js";import{T as v,a as b,b as x,c as a,d as y,e as t}from"./table.js";import{T as R}from"./triangle-alert.js";import{C as k}from"./clock.js";import{T as q}from"./trash-2.js";function z(){const[c,w]=m.useState([]),[h,C]=m.useState([]),[S,T]=m.useState(!0);m.useEffect(()=>{f()},[]);const f=async()=>{try{const{data:s,error:r}=await u.from("login_attempts").select("*").order("attempt_time",{ascending:!1}).limit(100);if(r)throw r;const{data:n,error:p}=await u.from("security_blocks").select("*").gt("blocked_until",new Date().toISOString()).order("created_at",{ascending:!1});if(p)throw p;w(s||[]),C(n||[])}catch(s){console.error("Error fetching security data:",s),j.error("Erreur lors du chargement des données de sécurité")}finally{T(!1)}},A=async s=>{try{const{error:r}=await u.from("security_blocks").delete().eq("id",s);if(r)throw r;j.success("Blocage supprimé avec succès"),f()}catch(r){console.error("Error removing block:",r),j.error("Erreur lors de la suppression du blocage")}},D=c.filter(s=>{const r=new Date(s.attempt_time),n=new Date;return n.setDate(n.getDate()-1),!s.success&&r>n}).length,B=c.length>0?(c.filter(s=>s.success).length/c.length*100).toFixed(1):"0";return S?e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/4"}),e.jsx("div",{className:"h-64 bg-muted rounded"})]})}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Sécurité & Logs"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Surveillance des tentatives de connexion et des blocages de sécurité"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(i,{children:[e.jsx(l,{className:"pb-2",children:e.jsx(d,{className:"text-sm font-medium",children:"Échecs (24h)"})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:D}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground mt-1",children:[e.jsx(R,{className:"h-3 w-3"}),"Tentatives échouées"]})]})]}),e.jsxs(i,{children:[e.jsx(l,{className:"pb-2",children:e.jsx(d,{className:"text-sm font-medium",children:"Comptes Bloqués"})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:h.length}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground mt-1",children:[e.jsx(E,{className:"h-3 w-3"}),"Actuellement actifs"]})]})]}),e.jsxs(i,{children:[e.jsx(l,{className:"pb-2",children:e.jsx(d,{className:"text-sm font-medium",children:"Taux de Réussite"})}),e.jsxs(o,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:[B,"%"]}),e.jsx("div",{className:"flex items-center gap-1 text-sm text-muted-foreground mt-1",children:"Connexions réussies"})]})]})]}),e.jsxs(i,{children:[e.jsxs(l,{children:[e.jsx(d,{children:"Comptes Bloqués"}),e.jsx(N,{children:"Blocages de sécurité actuellement actifs"})]}),e.jsx(o,{children:h.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Aucun compte bloqué actuellement"}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(x,{children:[e.jsx(a,{children:"Email"}),e.jsx(a,{children:"Adresse IP"}),e.jsx(a,{children:"Raison"}),e.jsx(a,{children:"Bloqué jusqu'à"}),e.jsx(a,{className:"text-right",children:"Actions"})]})}),e.jsx(y,{children:h.map(s=>e.jsxs(x,{children:[e.jsx(t,{className:"font-medium",children:s.email||"N/A"}),e.jsx(t,{children:s.ip_address||"N/A"}),e.jsx(t,{children:e.jsx(g,{variant:"destructive",children:s.reason})}),e.jsx(t,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-muted-foreground"}),new Date(s.blocked_until).toLocaleString("fr-FR")]})}),e.jsx(t,{className:"text-right",children:e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>A(s.id),children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Débloquer"]})})]},s.id))})]})})})]}),e.jsxs(i,{children:[e.jsxs(l,{children:[e.jsx(d,{children:"Tentatives de Connexion Récentes"}),e.jsx(N,{children:"100 dernières tentatives de connexion"})]}),e.jsx(o,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(x,{children:[e.jsx(a,{children:"Email"}),e.jsx(a,{children:"Adresse IP"}),e.jsx(a,{children:"Date & Heure"}),e.jsx(a,{children:"Statut"})]})}),e.jsx(y,{children:c.length===0?e.jsx(x,{children:e.jsx(t,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"Aucune tentative de connexion enregistrée"})}):c.map(s=>e.jsxs(x,{children:[e.jsx(t,{className:"font-medium",children:s.email}),e.jsx(t,{children:s.ip_address}),e.jsx(t,{children:new Date(s.attempt_time).toLocaleString("fr-FR")}),e.jsx(t,{children:s.success?e.jsx(g,{variant:"default",className:"bg-green-500",children:"Réussie"}):e.jsx(g,{variant:"destructive",children:"Échouée"})})]},s.id))})]})})})]})]})}export{z as default};
