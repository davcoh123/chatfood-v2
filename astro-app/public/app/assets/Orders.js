import{l as Ft,d as Le,m as z,s as K,r as b,R as ct,j as t,D as dt,n as ut,o as mt,p as ft,q as vt,t as ht,B as I,P as ke,C as V,a as J,e as G,c as X,X as Lt,M as Et,v as Q,w as It,x as Ge,b as me,I as de,T as Wt,g as At,y as Rt}from"./index.js";import{T as Bt,a as Yt,b as re,c as oe}from"./tabs.js";import{u as Se}from"./useQuery.js";import{a as Ht,u as xt}from"./useRestaurantSettings.js";import{T as Ee}from"./textarea.js";import{L as Z}from"./label.js";import{L as Ie}from"./loader-circle.js";import{H as qt,T as $t,C as zt,a as Vt,D as Ut,S as Kt,B as Gt,b as Qt,P as Zt}from"./truck.js";import{P as Jt}from"./phone.js";import{C as Xt}from"./check.js";import{t as k,s as fe,a as ee,g as Qe,m as ea,c as We,f as W,b as Oe,e as ta,d as q,h as aa,i as Ae,j as na,k as sa,l as pt}from"./fr.js";import{T as ra,a as oa,b as Ze,c as ie,d as ia,e as le}from"./table.js";import{S as la,a as ca,b as da,c as ua,d as be}from"./select.js";import{P as Je,a as Xe,b as et}from"./popover.js";import{a as B,e as Re,s as F,b as T,c as Be,d as Te}from"./endOfWeek.js";import{R as ma}from"./rotate-ccw.js";import{D as fa}from"./download.js";import{S as va}from"./search.js";import{C as ce}from"./calendar.js";import{C as ha}from"./clock.js";import{S as xa}from"./switch.js";import{S as pa}from"./scroll-area.js";import{S as je}from"./star.js";import{u as ga}from"./useWhatsAppIntegration.js";import"./index2.js";import"./index3.js";import"./index4.js";import"./index5.js";function ya(e,a){return B(e,a*12)}function ba(e){let a;return e.forEach(function(n){const s=k(n);(a===void 0||a<s||isNaN(Number(s)))&&(a=s)}),a||new Date(NaN)}function ja(e){let a;return e.forEach(n=>{const s=k(n);(!a||a>s||isNaN(+s))&&(a=s)}),a||new Date(NaN)}function P(e,a){const n=fe(e),s=fe(a);return+n==+s}function te(e,a){const n=k(e),s=k(a),r=n.getFullYear()-s.getFullYear(),o=n.getMonth()-s.getMonth();return r*12+o}function _a(e,a,n){const s=ee(e,n),r=ee(a,n),o=+s-Qe(s),i=+r-Qe(r);return Math.round((o-i)/ea)}function gt(e){return Re(e,{weekStartsOn:1})}function Na(e){const a=k(e),n=a.getFullYear(),s=a.getMonth(),r=We(e,0);return r.setFullYear(n,s+1,0),r.setHours(0,0,0,0),r.getDate()}function wa(e){return Math.trunc(+k(e)/1e3)}function Ca(e){const a=k(e),n=a.getMonth();return a.setFullYear(a.getFullYear(),n+1,0),a.setHours(0,0,0,0),a}function Da(e,a){return _a(Ca(e),F(e),a)+1}function Pe(e,a){const n=k(e),s=k(a);return n.getTime()>s.getTime()}function yt(e,a){const n=k(e),s=k(a);return+n<+s}function Ye(e,a){const n=k(e),s=k(a);return n.getFullYear()===s.getFullYear()&&n.getMonth()===s.getMonth()}function Ma(e,a){const n=k(e),s=k(a);return n.getFullYear()===s.getFullYear()}function _e(e,a){return T(e,-a)}function Ne(e,a){const n=k(e),s=n.getFullYear(),r=n.getDate(),o=We(e,0);o.setFullYear(s,a,15),o.setHours(0,0,0,0);const i=Na(o);return n.setMonth(a,Math.min(r,i)),n}function tt(e,a){const n=k(e);return isNaN(+n)?We(e,NaN):(n.setFullYear(a),n)}const ka=e=>{const a=Ft(),{profile:n}=Le(),s=e??(n==null?void 0:n.user_id),{data:r=[]}=Se({queryKey:["products-for-orders",s],queryFn:async()=>{if(!s)return[];const{data:f,error:g}=await K.from("products").select("id, name, category").eq("user_id",s);return g?(console.error("Error fetching products:",g),[]):(f||[]).map(m=>({id:m.id,name:m.name,category:m.category}))},enabled:!!s}),{data:o=[],isLoading:i,error:l}=Se({queryKey:["orders",s],queryFn:async()=>{if(!s)return[];const{data:f,error:g}=await K.from("chatbot_orders").select("*").eq("user_id",s).order("heure_de_commande",{ascending:!1});if(g)throw console.error("Error fetching orders:",g),g;return(f||[]).map(m=>({id:m.id,name:m.name||"Client",phone:m.phone,commande_item:Array.isArray(m.commande_item)?m.commande_item:[],price_total:m.price_total||0,note:m.note,commande_type:m.commande_type,horaire_recup:m.horaire_recup,heure_de_commande:m.heure_de_commande,status:m.status||"pending"}))},enabled:!!s,refetchInterval:3e4}),c=Ht({mutationFn:async({orderId:f,newStatus:g})=>{if(!s)throw new Error("Utilisateur non connectÃ©");const{error:m}=await K.from("chatbot_orders").update({status:g}).eq("id",f).eq("user_id",s);if(m)throw m;if(g==="delivered")try{console.log("Order delivered, triggering review request for order:",f);const{error:j}=await K.functions.invoke("trigger-review-request",{body:{order_id:f}});j&&console.error("Error triggering review request:",j)}catch(j){console.error("Failed to invoke trigger-review-request:",j)}return{success:!0}},onSuccess:()=>{z.success("Statut de commande mis Ã  jour"),a.invalidateQueries({queryKey:["orders",s]})},onError:f=>{z.error(f.message)}}),d=()=>o.filter(f=>["pending","confirmed","preparing","ready"].includes(f.status)),u=()=>{const f=new Date().toISOString().split("T")[0];return o.filter(g=>g.heure_de_commande.startsWith(f))};return{orders:o,products:r,isLoading:i,error:l,getPendingOrders:d,getTodayOrders:u,getOrdersHistory:()=>o.filter(f=>["delivered","cancelled"].includes(f.status)),getTodayRevenue:()=>u().filter(f=>f.status==="delivered").reduce((f,g)=>f+g.price_total,0),getAveragePreparationTime:()=>0,updateOrderStatus:c.mutate,isUpdating:c.isPending}},at="orderNotificationEnabled",Sa=()=>{try{const e=new(window.AudioContext||window.webkitAudioContext),a=e.createOscillator(),n=e.createGain();a.connect(n),n.connect(e.destination),a.frequency.setValueAtTime(880,e.currentTime),a.type="sine",n.gain.setValueAtTime(.3,e.currentTime),n.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),a.start(e.currentTime),a.stop(e.currentTime+.5),setTimeout(()=>{const s=e.createOscillator(),r=e.createGain();s.connect(r),r.connect(e.destination),s.frequency.setValueAtTime(1174.66,e.currentTime),s.type="sine",r.gain.setValueAtTime(.3,e.currentTime),r.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),s.start(e.currentTime),s.stop(e.currentTime+.5)},150)}catch(e){console.warn("Could not play notification sound:",e)}},Oa=e=>{const a=b.useRef(new Set),n=b.useRef(!0),[s,r]=b.useState(()=>{const i=localStorage.getItem(at);return i===null?!0:i==="true"}),o=b.useCallback(()=>{r(i=>{const l=!i;return localStorage.setItem(at,String(l)),l})},[]);return b.useEffect(()=>{if(!e||e.length===0)return;const i=new Set(e.map(c=>c.id));if(n.current){a.current=i,n.current=!1;return}e.filter(c=>!a.current.has(c.id)&&c.status==="pending").length>0&&s&&Sa(),a.current=i},[e,s]),{notificationEnabled:s,toggleNotification:o}},Ta=({open:e,onOpenChange:a,customerName:n,customerPhone:s,restaurantName:r,restaurantPhone:o,phoneNumberId:i,whatsappBusinessId:l,accessToken:c,userId:d,onConfirmCancel:u})=>{const v=`Bonjour ${n},
Nous sommes dÃ©solÃ©s, mais ${r} a dÃ» annuler votre commande.
Vous pouvez repasser commande quand vous voulez. Merci pour votre comprÃ©hension ðŸ™`,[x,h]=b.useState(v),[f,g]=b.useState(!1);ct.useEffect(()=>{e&&h(`Bonjour ${n},
Nous sommes dÃ©solÃ©s, mais ${r} a dÃ» annuler votre commande.
Vous pouvez repasser commande quand vous voulez. Merci pour votre comprÃ©hension ðŸ™`)},[e,n,r]);const m=async()=>{g(!0);try{if(!(await fetch("https://n8n.chatfood.fr/webhook/send-whatsapp-message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to_number:s,message:x,restaurant_phone:o,phone_number_id:i,whatsapp_business_id:l,access_token:c,user_id:d,customer_name:n})})).ok)throw new Error("Erreur lors de l'envoi du message");z.success("Message envoyÃ© au client"),u(),a(!1)}catch(j){console.error("Error sending cancellation message:",j),z.error("Erreur lors de l'envoi du message")}finally{g(!1)}};return t.jsx(dt,{open:e,onOpenChange:a,children:t.jsxs(ut,{className:"sm:max-w-lg",children:[t.jsxs(mt,{children:[t.jsx(ft,{children:"Annuler la commande"}),t.jsx(vt,{children:"Envoyez un message au client pour l'informer de l'annulation"})]}),t.jsx("div",{className:"space-y-4 py-4",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx(Z,{htmlFor:"cancel-message",children:"Message au client"}),t.jsx(Ee,{id:"cancel-message",value:x,onChange:j=>h(j.target.value),rows:6,className:"resize-none"}),t.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ce message sera envoyÃ© via WhatsApp au client (",s,")"]})]})}),t.jsxs(ht,{className:"gap-2 sm:gap-0",children:[t.jsx(I,{variant:"outline",onClick:()=>a(!1),disabled:f,children:"Fermer"}),t.jsx(I,{variant:"destructive",onClick:m,disabled:f||!x.trim(),children:f?t.jsxs(t.Fragment,{children:[t.jsx(Ie,{className:"mr-2 h-4 w-4 animate-spin"}),"Envoi..."]}):"Confirmer l'annulation"})]})]})})},Pa=({open:e,onOpenChange:a,customerName:n,customerPhone:s,restaurantPhone:r,phoneNumberId:o,whatsappBusinessId:i,accessToken:l,userId:c})=>{const[d,u]=b.useState(""),[v,x]=b.useState(!1);ct.useEffect(()=>{e&&u("")},[e]);const h=async()=>{if(d.trim()){x(!0);try{if(!(await fetch("https://n8n.chatfood.fr/webhook/send-whatsapp-message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to_number:s,message:d,restaurant_phone:r,phone_number_id:o,whatsapp_business_id:i,access_token:l,user_id:c,customer_name:n})})).ok)throw new Error("Erreur lors de l'envoi du message");z.success("Message envoyÃ©"),a(!1)}catch(f){console.error("Error sending message:",f),z.error("Erreur lors de l'envoi du message")}finally{x(!1)}}};return t.jsx(dt,{open:e,onOpenChange:a,children:t.jsxs(ut,{className:"sm:max-w-lg",children:[t.jsxs(mt,{children:[t.jsxs(ft,{children:["Envoyer un message Ã  ",n]}),t.jsxs(vt,{children:["Ce message sera envoyÃ© via WhatsApp au ",s]})]}),t.jsx("div",{className:"space-y-4 py-4",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx(Z,{htmlFor:"message",children:"Votre message"}),t.jsx(Ee,{id:"message",value:d,onChange:f=>u(f.target.value),rows:5,placeholder:"Tapez votre message ici...",className:"resize-none"})]})}),t.jsxs(ht,{className:"gap-2 sm:gap-0",children:[t.jsx(I,{variant:"outline",onClick:()=>a(!1),disabled:v,children:"Annuler"}),t.jsx(I,{onClick:h,disabled:v||!d.trim(),children:v?t.jsxs(t.Fragment,{children:[t.jsx(Ie,{className:"mr-2 h-4 w-4 animate-spin"}),"Envoi..."]}):"Envoyer"})]})]})})},nt={pending:{label:"En attente",color:"bg-yellow-500",icon:"ðŸŸ¡"},confirmed:{label:"ConfirmÃ©e",color:"bg-green-500",icon:"ðŸŸ¢"},preparing:{label:"En prÃ©paration",color:"bg-blue-500",icon:"ðŸ”µ"},ready:{label:"PrÃªte",color:"bg-purple-500",icon:"ðŸŸ£"},delivered:{label:"RÃ©cupÃ©rÃ©e",color:"bg-muted",icon:"âœ…"},cancelled:{label:"AnnulÃ©e",color:"bg-red-500",icon:"ðŸ”´"}},st={scheduled_takeaway:{label:"Ã€ emporter (programmÃ©)",icon:ke},immediate_takeaway:{label:"Ã€ emporter",icon:ke},delivery:{label:"Livraison",icon:$t},dine_in:{label:"Sur place",icon:qt}},Fa=({order:e,onUpdateStatus:a,isUpdating:n,restaurantName:s="",restaurantPhone:r="",phoneNumberId:o="",whatsappBusinessId:i="",accessToken:l="",userId:c="",products:d=[]})=>{const[u,v]=b.useState(!1),[x,h]=b.useState(!1),f=nt[e.status]||nt.pending,g=st[e.commande_type]||st.immediate_takeaway,m=g.icon,j=()=>{try{return W(new Date(e.heure_de_commande),"dd/MM Ã  HH:mm",{locale:Oe})}catch{return""}},p=()=>{if(!e.horaire_recup)return null;try{return W(new Date(e.horaire_recup),"HH:mm",{locale:Oe})}catch{return null}},D=w=>{const E=d.find(O=>O.id===w);return(E==null?void 0:E.category)||null},M=w=>{const E=w.product_id?D(w.product_id):null;return E?`${w.qty}x ${E} - ${w.name}`:`${w.qty}x ${w.name}`},A=()=>{a(e.id,"delivered")},L=()=>{a(e.id,"cancelled")},R=p(),S=j();return t.jsxs(t.Fragment,{children:[t.jsxs(V,{className:"border-2 hover:border-primary/30 transition-colors",children:[t.jsx(J,{className:"pb-3",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[t.jsx("div",{className:"flex items-start gap-3",children:t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("span",{className:"text-base sm:text-lg font-bold truncate",children:e.name}),t.jsxs(G,{className:`${f.color} text-xs sm:text-sm`,children:[f.icon," ",f.label]})]}),t.jsx("div",{className:"flex items-center gap-2 mt-1 text-xs sm:text-sm text-muted-foreground",children:t.jsxs("span",{children:["CommandÃ© le ",S]})})]})}),t.jsxs("div",{className:"text-left sm:text-right flex sm:block items-center justify-between sm:justify-start gap-2",children:[t.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-primary",children:[e.price_total.toFixed(2),"â‚¬"]}),t.jsxs("div",{className:"flex items-center gap-1 text-xs sm:text-sm text-muted-foreground sm:justify-end",children:[t.jsx(m,{className:"h-3 w-3"}),t.jsx("span",{children:g.label})]})]})]})}),t.jsxs(X,{className:"space-y-3",children:[R&&t.jsxs("div",{className:"flex items-center gap-2 text-sm bg-primary/10 rounded-lg p-2 font-medium",children:[t.jsx(zt,{className:"h-4 w-4 text-primary"}),t.jsxs("span",{children:["RÃ©cupÃ©ration prÃ©vue : ",R]})]}),e.note&&t.jsxs("div",{className:"text-sm bg-amber-500/10 rounded-lg p-2 text-amber-700 dark:text-amber-300",children:["ðŸ“ ",e.note]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[t.jsx("div",{className:"font-semibold",children:e.name}),t.jsxs("a",{href:`https://wa.me/${e.phone.replace("+","")}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-primary hover:underline",children:[t.jsx(Jt,{className:"h-3 w-3"}),e.phone]})]}),t.jsx("div",{className:"bg-muted/30 rounded-lg p-3 space-y-2",children:e.commande_item.map((w,E)=>t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex justify-between text-sm",children:[t.jsx("span",{className:"font-medium",children:M(w)}),t.jsxs("span",{className:"text-muted-foreground",children:[parseFloat(w.line_total).toFixed(2),"â‚¬"]})]}),w.addons&&w.addons.length>0&&t.jsx("div",{className:"pl-4 text-xs text-muted-foreground",children:w.addons.map((O,$)=>t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{children:["+ ",O.label]}),t.jsxs("span",{children:["+",parseFloat(O.price).toFixed(2),"â‚¬"]})]},$))}),w.menu_choices&&Object.values(w.menu_choices).some(O=>O)&&t.jsx("div",{className:"pl-4 text-xs text-muted-foreground",children:Object.entries(w.menu_choices).map(([O,$])=>$&&t.jsxs("div",{children:["â€¢ Choix: ",$]},O))})]},E))}),!["delivered","cancelled"].includes(e.status)&&t.jsxs("div",{className:"flex gap-2 pt-2",children:[t.jsxs(I,{variant:"default",size:"sm",className:"flex-1",onClick:A,disabled:n,children:[t.jsx(Xt,{className:"h-4 w-4 mr-1"}),"RÃ©cupÃ©rÃ©e"]}),t.jsxs(I,{variant:"destructive",size:"sm",className:"flex-1",onClick:()=>v(!0),disabled:n,children:[t.jsx(Lt,{className:"h-4 w-4 mr-1"}),"Annuler"]}),t.jsx(I,{variant:"outline",size:"icon",className:"h-9 w-9 shrink-0",onClick:()=>h(!0),title:"Envoyer un message",children:t.jsx(Et,{className:"h-4 w-4"})})]})]})]}),t.jsx(Ta,{open:u,onOpenChange:v,customerName:e.name,customerPhone:e.phone,restaurantName:s,restaurantPhone:r,phoneNumberId:o,whatsappBusinessId:i,accessToken:l,userId:c,onConfirmCancel:L}),t.jsx(Pa,{open:x,onOpenChange:h,customerName:e.name,customerPhone:e.phone,restaurantPhone:r,phoneNumberId:o,whatsappBusinessId:i,accessToken:l,userId:c})]})};var _=function(){return _=Object.assign||function(a){for(var n,s=1,r=arguments.length;s<r;s++){n=arguments[s];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(a[o]=n[o])}return a},_.apply(this,arguments)};function La(e,a){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&a.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(e);r<s.length;r++)a.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]]);return n}function bt(e,a,n){for(var s=0,r=a.length,o;s<r;s++)(o||!(s in a))&&(o||(o=Array.prototype.slice.call(a,0,s)),o[s]=a[s]);return e.concat(o||Array.prototype.slice.call(a))}function ae(e){return e.mode==="multiple"}function ne(e){return e.mode==="range"}function he(e){return e.mode==="single"}var Ea={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function Ia(e,a){return W(e,"LLLL y",a)}function Wa(e,a){return W(e,"d",a)}function Aa(e,a){return W(e,"LLLL",a)}function Ra(e){return"".concat(e)}function Ba(e,a){return W(e,"cccccc",a)}function Ya(e,a){return W(e,"yyyy",a)}var Ha=Object.freeze({__proto__:null,formatCaption:Ia,formatDay:Wa,formatMonthCaption:Aa,formatWeekNumber:Ra,formatWeekdayName:Ba,formatYearCaption:Ya}),qa=function(e,a,n){return W(e,"do MMMM (EEEE)",n)},$a=function(){return"Month: "},za=function(){return"Go to next month"},Va=function(){return"Go to previous month"},Ua=function(e,a){return W(e,"cccc",a)},Ka=function(e){return"Week n. ".concat(e)},Ga=function(){return"Year: "},Qa=Object.freeze({__proto__:null,labelDay:qa,labelMonthDropdown:$a,labelNext:za,labelPrevious:Va,labelWeekNumber:Ka,labelWeekday:Ua,labelYearDropdown:Ga});function Za(){var e="buttons",a=Ea,n=ta,s={},r={},o=1,i={},l=new Date;return{captionLayout:e,classNames:a,formatters:Ha,labels:Qa,locale:n,modifiersClassNames:s,modifiers:r,numberOfMonths:o,styles:i,today:l,mode:"default"}}function Ja(e){var a=e.fromYear,n=e.toYear,s=e.fromMonth,r=e.toMonth,o=e.fromDate,i=e.toDate;return s?o=F(s):a&&(o=new Date(a,0,1)),r?i=Be(r):n&&(i=new Date(n,11,31)),{fromDate:o?fe(o):void 0,toDate:i?fe(i):void 0}}var jt=b.createContext(void 0);function Xa(e){var a,n=e.initialProps,s=Za(),r=Ja(n),o=r.fromDate,i=r.toDate,l=(a=n.captionLayout)!==null&&a!==void 0?a:s.captionLayout;l!=="buttons"&&(!o||!i)&&(l="buttons");var c;(he(n)||ae(n)||ne(n))&&(c=n.onSelect);var d=_(_(_({},s),n),{captionLayout:l,classNames:_(_({},s.classNames),n.classNames),components:_({},n.components),formatters:_(_({},s.formatters),n.formatters),fromDate:o,labels:_(_({},s.labels),n.labels),mode:n.mode||s.mode,modifiers:_(_({},s.modifiers),n.modifiers),modifiersClassNames:_(_({},s.modifiersClassNames),n.modifiersClassNames),onSelect:c,styles:_(_({},s.styles),n.styles),toDate:i});return t.jsx(jt.Provider,{value:d,children:e.children})}function C(){var e=b.useContext(jt);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function _t(e){var a=C(),n=a.locale,s=a.classNames,r=a.styles,o=a.formatters.formatCaption;return t.jsx("div",{className:s.caption_label,style:r.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:o(e.displayMonth,{locale:n})})}function en(e){return t.jsx("svg",_({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:t.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Nt(e){var a,n,s=e.onChange,r=e.value,o=e.children,i=e.caption,l=e.className,c=e.style,d=C(),u=(n=(a=d.components)===null||a===void 0?void 0:a.IconDropdown)!==null&&n!==void 0?n:en;return t.jsxs("div",{className:l,style:c,children:[t.jsx("span",{className:d.classNames.vhidden,children:e["aria-label"]}),t.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:d.classNames.dropdown,style:d.styles.dropdown,value:r,onChange:s,children:o}),t.jsxs("div",{className:d.classNames.caption_label,style:d.styles.caption_label,"aria-hidden":"true",children:[i,t.jsx(u,{className:d.classNames.dropdown_icon,style:d.styles.dropdown_icon})]})]})}function tn(e){var a,n=C(),s=n.fromDate,r=n.toDate,o=n.styles,i=n.locale,l=n.formatters.formatMonthCaption,c=n.classNames,d=n.components,u=n.labels.labelMonthDropdown;if(!s)return t.jsx(t.Fragment,{});if(!r)return t.jsx(t.Fragment,{});var v=[];if(Ma(s,r))for(var x=F(s),h=s.getMonth();h<=r.getMonth();h++)v.push(Ne(x,h));else for(var x=F(new Date),h=0;h<=11;h++)v.push(Ne(x,h));var f=function(m){var j=Number(m.target.value),p=Ne(F(e.displayMonth),j);e.onChange(p)},g=(a=d==null?void 0:d.Dropdown)!==null&&a!==void 0?a:Nt;return t.jsx(g,{name:"months","aria-label":u(),className:c.dropdown_month,style:o.dropdown_month,onChange:f,value:e.displayMonth.getMonth(),caption:l(e.displayMonth,{locale:i}),children:v.map(function(m){return t.jsx("option",{value:m.getMonth(),children:l(m,{locale:i})},m.getMonth())})})}function an(e){var a,n=e.displayMonth,s=C(),r=s.fromDate,o=s.toDate,i=s.locale,l=s.styles,c=s.classNames,d=s.components,u=s.formatters.formatYearCaption,v=s.labels.labelYearDropdown,x=[];if(!r)return t.jsx(t.Fragment,{});if(!o)return t.jsx(t.Fragment,{});for(var h=r.getFullYear(),f=o.getFullYear(),g=h;g<=f;g++)x.push(tt(aa(new Date),g));var m=function(p){var D=tt(F(n),Number(p.target.value));e.onChange(D)},j=(a=d==null?void 0:d.Dropdown)!==null&&a!==void 0?a:Nt;return t.jsx(j,{name:"years","aria-label":v(),className:c.dropdown_year,style:l.dropdown_year,onChange:m,value:n.getFullYear(),caption:u(n,{locale:i}),children:x.map(function(p){return t.jsx("option",{value:p.getFullYear(),children:u(p,{locale:i})},p.getFullYear())})})}function nn(e,a){var n=b.useState(e),s=n[0],r=n[1],o=a===void 0?s:a;return[o,r]}function sn(e){var a=e.month,n=e.defaultMonth,s=e.today,r=a||n||s||new Date,o=e.toDate,i=e.fromDate,l=e.numberOfMonths,c=l===void 0?1:l;if(o&&te(o,r)<0){var d=-1*(c-1);r=B(o,d)}return i&&te(r,i)<0&&(r=i),F(r)}function rn(){var e=C(),a=sn(e),n=nn(a,e.month),s=n[0],r=n[1],o=function(i){var l;if(!e.disableNavigation){var c=F(i);r(c),(l=e.onMonthChange)===null||l===void 0||l.call(e,c)}};return[s,o]}function on(e,a){for(var n=a.reverseMonths,s=a.numberOfMonths,r=F(e),o=F(B(r,s)),i=te(o,r),l=[],c=0;c<i;c++){var d=B(r,c);l.push(d)}return n&&(l=l.reverse()),l}function ln(e,a){if(!a.disableNavigation){var n=a.toDate,s=a.pagedNavigation,r=a.numberOfMonths,o=r===void 0?1:r,i=s?o:1,l=F(e);if(!n)return B(l,i);var c=te(n,e);if(!(c<o))return B(l,i)}}function cn(e,a){if(!a.disableNavigation){var n=a.fromDate,s=a.pagedNavigation,r=a.numberOfMonths,o=r===void 0?1:r,i=s?o:1,l=F(e);if(!n)return B(l,-i);var c=te(l,n);if(!(c<=0))return B(l,-i)}}var wt=b.createContext(void 0);function dn(e){var a=C(),n=rn(),s=n[0],r=n[1],o=on(s,a),i=ln(s,a),l=cn(s,a),c=function(v){return o.some(function(x){return Ye(v,x)})},d=function(v,x){c(v)||(x&&yt(v,x)?r(B(v,1+a.numberOfMonths*-1)):r(v))},u={currentMonth:s,displayMonths:o,goToMonth:r,goToDate:d,previousMonth:l,nextMonth:i,isDateDisplayed:c};return t.jsx(wt.Provider,{value:u,children:e.children})}function se(){var e=b.useContext(wt);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function rt(e){var a,n=C(),s=n.classNames,r=n.styles,o=n.components,i=se().goToMonth,l=function(u){i(B(u,e.displayIndex?-e.displayIndex:0))},c=(a=o==null?void 0:o.CaptionLabel)!==null&&a!==void 0?a:_t,d=t.jsx(c,{id:e.id,displayMonth:e.displayMonth});return t.jsxs("div",{className:s.caption_dropdowns,style:r.caption_dropdowns,children:[t.jsx("div",{className:s.vhidden,children:d}),t.jsx(tn,{onChange:l,displayMonth:e.displayMonth}),t.jsx(an,{onChange:l,displayMonth:e.displayMonth})]})}function un(e){return t.jsx("svg",_({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:t.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function mn(e){return t.jsx("svg",_({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:t.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var ve=b.forwardRef(function(e,a){var n=C(),s=n.classNames,r=n.styles,o=[s.button_reset,s.button];e.className&&o.push(e.className);var i=o.join(" "),l=_(_({},r.button_reset),r.button);return e.style&&Object.assign(l,e.style),t.jsx("button",_({},e,{ref:a,type:"button",className:i,style:l}))});function fn(e){var a,n,s=C(),r=s.dir,o=s.locale,i=s.classNames,l=s.styles,c=s.labels,d=c.labelPrevious,u=c.labelNext,v=s.components;if(!e.nextMonth&&!e.previousMonth)return t.jsx(t.Fragment,{});var x=d(e.previousMonth,{locale:o}),h=[i.nav_button,i.nav_button_previous].join(" "),f=u(e.nextMonth,{locale:o}),g=[i.nav_button,i.nav_button_next].join(" "),m=(a=v==null?void 0:v.IconRight)!==null&&a!==void 0?a:mn,j=(n=v==null?void 0:v.IconLeft)!==null&&n!==void 0?n:un;return t.jsxs("div",{className:i.nav,style:l.nav,children:[!e.hidePrevious&&t.jsx(ve,{name:"previous-month","aria-label":x,className:h,style:l.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:r==="rtl"?t.jsx(m,{className:i.nav_icon,style:l.nav_icon}):t.jsx(j,{className:i.nav_icon,style:l.nav_icon})}),!e.hideNext&&t.jsx(ve,{name:"next-month","aria-label":f,className:g,style:l.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:r==="rtl"?t.jsx(j,{className:i.nav_icon,style:l.nav_icon}):t.jsx(m,{className:i.nav_icon,style:l.nav_icon})})]})}function ot(e){var a=C().numberOfMonths,n=se(),s=n.previousMonth,r=n.nextMonth,o=n.goToMonth,i=n.displayMonths,l=i.findIndex(function(f){return Ye(e.displayMonth,f)}),c=l===0,d=l===i.length-1,u=a>1&&(c||!d),v=a>1&&(d||!c),x=function(){s&&o(s)},h=function(){r&&o(r)};return t.jsx(fn,{displayMonth:e.displayMonth,hideNext:u,hidePrevious:v,nextMonth:r,previousMonth:s,onPreviousClick:x,onNextClick:h})}function vn(e){var a,n=C(),s=n.classNames,r=n.disableNavigation,o=n.styles,i=n.captionLayout,l=n.components,c=(a=l==null?void 0:l.CaptionLabel)!==null&&a!==void 0?a:_t,d;return r?d=t.jsx(c,{id:e.id,displayMonth:e.displayMonth}):i==="dropdown"?d=t.jsx(rt,{displayMonth:e.displayMonth,id:e.id}):i==="dropdown-buttons"?d=t.jsxs(t.Fragment,{children:[t.jsx(rt,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),t.jsx(ot,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):d=t.jsxs(t.Fragment,{children:[t.jsx(c,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),t.jsx(ot,{displayMonth:e.displayMonth,id:e.id})]}),t.jsx("div",{className:s.caption,style:o.caption,children:d})}function hn(e){var a=C(),n=a.footer,s=a.styles,r=a.classNames.tfoot;return n?t.jsx("tfoot",{className:r,style:s.tfoot,children:t.jsx("tr",{children:t.jsx("td",{colSpan:8,children:n})})}):t.jsx(t.Fragment,{})}function xn(e,a,n){for(var s=n?Ae(new Date):ee(new Date,{locale:e,weekStartsOn:a}),r=[],o=0;o<7;o++){var i=T(s,o);r.push(i)}return r}function pn(){var e=C(),a=e.classNames,n=e.styles,s=e.showWeekNumber,r=e.locale,o=e.weekStartsOn,i=e.ISOWeek,l=e.formatters.formatWeekdayName,c=e.labels.labelWeekday,d=xn(r,o,i);return t.jsxs("tr",{style:n.head_row,className:a.head_row,children:[s&&t.jsx("td",{style:n.head_cell,className:a.head_cell}),d.map(function(u,v){return t.jsx("th",{scope:"col",className:a.head_cell,style:n.head_cell,"aria-label":c(u,{locale:r}),children:l(u,{locale:r})},v)})]})}function gn(){var e,a=C(),n=a.classNames,s=a.styles,r=a.components,o=(e=r==null?void 0:r.HeadRow)!==null&&e!==void 0?e:pn;return t.jsx("thead",{style:s.head,className:n.head,children:t.jsx(o,{})})}function yn(e){var a=C(),n=a.locale,s=a.formatters.formatDay;return t.jsx(t.Fragment,{children:s(e.date,{locale:n})})}var He=b.createContext(void 0);function bn(e){if(!ae(e.initialProps)){var a={selected:void 0,modifiers:{disabled:[]}};return t.jsx(He.Provider,{value:a,children:e.children})}return t.jsx(jn,{initialProps:e.initialProps,children:e.children})}function jn(e){var a=e.initialProps,n=e.children,s=a.selected,r=a.min,o=a.max,i=function(d,u,v){var x,h;(x=a.onDayClick)===null||x===void 0||x.call(a,d,u,v);var f=!!(u.selected&&r&&(s==null?void 0:s.length)===r);if(!f){var g=!!(!u.selected&&o&&(s==null?void 0:s.length)===o);if(!g){var m=s?bt([],s):[];if(u.selected){var j=m.findIndex(function(p){return P(d,p)});m.splice(j,1)}else m.push(d);(h=a.onSelect)===null||h===void 0||h.call(a,m,d,u,v)}}},l={disabled:[]};s&&l.disabled.push(function(d){var u=o&&s.length>o-1,v=s.some(function(x){return P(x,d)});return!!(u&&!v)});var c={selected:s,onDayClick:i,modifiers:l};return t.jsx(He.Provider,{value:c,children:n})}function qe(){var e=b.useContext(He);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function _n(e,a){var n=a||{},s=n.from,r=n.to;return s&&r?P(r,e)&&P(s,e)?void 0:P(r,e)?{from:r,to:void 0}:P(s,e)?void 0:Pe(s,e)?{from:e,to:r}:{from:s,to:e}:r?Pe(e,r)?{from:r,to:e}:{from:e,to:r}:s?yt(e,s)?{from:e,to:s}:{from:s,to:e}:{from:e,to:void 0}}var $e=b.createContext(void 0);function Nn(e){if(!ne(e.initialProps)){var a={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return t.jsx($e.Provider,{value:a,children:e.children})}return t.jsx(wn,{initialProps:e.initialProps,children:e.children})}function wn(e){var a=e.initialProps,n=e.children,s=a.selected,r=s||{},o=r.from,i=r.to,l=a.min,c=a.max,d=function(h,f,g){var m,j;(m=a.onDayClick)===null||m===void 0||m.call(a,h,f,g);var p=_n(h,s);(j=a.onSelect)===null||j===void 0||j.call(a,p,h,f,g)},u={range_start:[],range_end:[],range_middle:[],disabled:[]};if(o?(u.range_start=[o],i?(u.range_end=[i],P(o,i)||(u.range_middle=[{after:o,before:i}])):u.range_end=[o]):i&&(u.range_start=[i],u.range_end=[i]),l&&(o&&!i&&u.disabled.push({after:_e(o,l-1),before:T(o,l-1)}),o&&i&&u.disabled.push({after:o,before:T(o,l-1)}),!o&&i&&u.disabled.push({after:_e(i,l-1),before:T(i,l-1)})),c){if(o&&!i&&(u.disabled.push({before:T(o,-c+1)}),u.disabled.push({after:T(o,c-1)})),o&&i){var v=q(i,o)+1,x=c-v;u.disabled.push({before:_e(o,x)}),u.disabled.push({after:T(i,x)})}!o&&i&&(u.disabled.push({before:T(i,-c+1)}),u.disabled.push({after:T(i,c-1)}))}return t.jsx($e.Provider,{value:{selected:s,onDayClick:d,modifiers:u},children:n})}function ze(){var e=b.useContext($e);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function ue(e){return Array.isArray(e)?bt([],e):e!==void 0?[e]:[]}function Cn(e){var a={};return Object.entries(e).forEach(function(n){var s=n[0],r=n[1];a[s]=ue(r)}),a}var Y;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(Y||(Y={}));var Dn=Y.Selected,H=Y.Disabled,Mn=Y.Hidden,kn=Y.Today,we=Y.RangeEnd,Ce=Y.RangeMiddle,De=Y.RangeStart,Sn=Y.Outside;function On(e,a,n){var s,r=(s={},s[Dn]=ue(e.selected),s[H]=ue(e.disabled),s[Mn]=ue(e.hidden),s[kn]=[e.today],s[we]=[],s[Ce]=[],s[De]=[],s[Sn]=[],s);return e.fromDate&&r[H].push({before:e.fromDate}),e.toDate&&r[H].push({after:e.toDate}),ae(e)?r[H]=r[H].concat(a.modifiers[H]):ne(e)&&(r[H]=r[H].concat(n.modifiers[H]),r[De]=n.modifiers[De],r[Ce]=n.modifiers[Ce],r[we]=n.modifiers[we]),r}var Ct=b.createContext(void 0);function Tn(e){var a=C(),n=qe(),s=ze(),r=On(a,n,s),o=Cn(a.modifiers),i=_(_({},r),o);return t.jsx(Ct.Provider,{value:i,children:e.children})}function Dt(){var e=b.useContext(Ct);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function Pn(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function Fn(e){return!!(e&&typeof e=="object"&&"from"in e)}function Ln(e){return!!(e&&typeof e=="object"&&"after"in e)}function En(e){return!!(e&&typeof e=="object"&&"before"in e)}function In(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function Wn(e,a){var n,s=a.from,r=a.to;if(s&&r){var o=q(r,s)<0;o&&(n=[r,s],s=n[0],r=n[1]);var i=q(e,s)>=0&&q(r,e)>=0;return i}return r?P(r,e):s?P(s,e):!1}function An(e){return pt(e)}function Rn(e){return Array.isArray(e)&&e.every(pt)}function Bn(e,a){return a.some(function(n){if(typeof n=="boolean")return n;if(An(n))return P(e,n);if(Rn(n))return n.includes(e);if(Fn(n))return Wn(e,n);if(In(n))return n.dayOfWeek.includes(e.getDay());if(Pn(n)){var s=q(n.before,e),r=q(n.after,e),o=s>0,i=r<0,l=Pe(n.before,n.after);return l?i&&o:o||i}return Ln(n)?q(e,n.after)>0:En(n)?q(n.before,e)>0:typeof n=="function"?n(e):!1})}function Ve(e,a,n){var s=Object.keys(a).reduce(function(o,i){var l=a[i];return Bn(e,l)&&o.push(i),o},[]),r={};return s.forEach(function(o){return r[o]=!0}),n&&!Ye(e,n)&&(r.outside=!0),r}function Yn(e,a){for(var n=F(e[0]),s=Be(e[e.length-1]),r,o,i=n;i<=s;){var l=Ve(i,a),c=!l.disabled&&!l.hidden;if(!c){i=T(i,1);continue}if(l.selected)return i;l.today&&!o&&(o=i),r||(r=i),i=T(i,1)}return o||r}var Hn=365;function Mt(e,a){var n=a.moveBy,s=a.direction,r=a.context,o=a.modifiers,i=a.retry,l=i===void 0?{count:0,lastFocused:e}:i,c=r.weekStartsOn,d=r.fromDate,u=r.toDate,v=r.locale,x={day:T,week:Te,month:B,year:ya,startOfWeek:function(m){return r.ISOWeek?Ae(m):ee(m,{locale:v,weekStartsOn:c})},endOfWeek:function(m){return r.ISOWeek?gt(m):Re(m,{locale:v,weekStartsOn:c})}},h=x[n](e,s==="after"?1:-1);s==="before"&&d?h=ba([d,h]):s==="after"&&u&&(h=ja([u,h]));var f=!0;if(o){var g=Ve(h,o);f=!g.disabled&&!g.hidden}return f?h:l.count>Hn?l.lastFocused:Mt(h,{moveBy:n,direction:s,context:r,modifiers:o,retry:_(_({},l),{count:l.count+1})})}var kt=b.createContext(void 0);function qn(e){var a=se(),n=Dt(),s=b.useState(),r=s[0],o=s[1],i=b.useState(),l=i[0],c=i[1],d=Yn(a.displayMonths,n),u=r??(l&&a.isDateDisplayed(l))?l:d,v=function(){c(r),o(void 0)},x=function(m){o(m)},h=C(),f=function(m,j){if(r){var p=Mt(r,{moveBy:m,direction:j,context:h,modifiers:n});P(r,p)||(a.goToDate(p,r),x(p))}},g={focusedDay:r,focusTarget:u,blur:v,focus:x,focusDayAfter:function(){return f("day","after")},focusDayBefore:function(){return f("day","before")},focusWeekAfter:function(){return f("week","after")},focusWeekBefore:function(){return f("week","before")},focusMonthBefore:function(){return f("month","before")},focusMonthAfter:function(){return f("month","after")},focusYearBefore:function(){return f("year","before")},focusYearAfter:function(){return f("year","after")},focusStartOfWeek:function(){return f("startOfWeek","before")},focusEndOfWeek:function(){return f("endOfWeek","after")}};return t.jsx(kt.Provider,{value:g,children:e.children})}function Ue(){var e=b.useContext(kt);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function $n(e,a){var n=Dt(),s=Ve(e,n,a);return s}var Ke=b.createContext(void 0);function zn(e){if(!he(e.initialProps)){var a={selected:void 0};return t.jsx(Ke.Provider,{value:a,children:e.children})}return t.jsx(Vn,{initialProps:e.initialProps,children:e.children})}function Vn(e){var a=e.initialProps,n=e.children,s=function(o,i,l){var c,d,u;if((c=a.onDayClick)===null||c===void 0||c.call(a,o,i,l),i.selected&&!a.required){(d=a.onSelect)===null||d===void 0||d.call(a,void 0,o,i,l);return}(u=a.onSelect)===null||u===void 0||u.call(a,o,o,i,l)},r={selected:a.selected,onDayClick:s};return t.jsx(Ke.Provider,{value:r,children:n})}function St(){var e=b.useContext(Ke);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function Un(e,a){var n=C(),s=St(),r=qe(),o=ze(),i=Ue(),l=i.focusDayAfter,c=i.focusDayBefore,d=i.focusWeekAfter,u=i.focusWeekBefore,v=i.blur,x=i.focus,h=i.focusMonthBefore,f=i.focusMonthAfter,g=i.focusYearBefore,m=i.focusYearAfter,j=i.focusStartOfWeek,p=i.focusEndOfWeek,D=function(N){var y,pe,ge,ye;he(n)?(y=s.onDayClick)===null||y===void 0||y.call(s,e,a,N):ae(n)?(pe=r.onDayClick)===null||pe===void 0||pe.call(r,e,a,N):ne(n)?(ge=o.onDayClick)===null||ge===void 0||ge.call(o,e,a,N):(ye=n.onDayClick)===null||ye===void 0||ye.call(n,e,a,N)},M=function(N){var y;x(e),(y=n.onDayFocus)===null||y===void 0||y.call(n,e,a,N)},A=function(N){var y;v(),(y=n.onDayBlur)===null||y===void 0||y.call(n,e,a,N)},L=function(N){var y;(y=n.onDayMouseEnter)===null||y===void 0||y.call(n,e,a,N)},R=function(N){var y;(y=n.onDayMouseLeave)===null||y===void 0||y.call(n,e,a,N)},S=function(N){var y;(y=n.onDayPointerEnter)===null||y===void 0||y.call(n,e,a,N)},w=function(N){var y;(y=n.onDayPointerLeave)===null||y===void 0||y.call(n,e,a,N)},E=function(N){var y;(y=n.onDayTouchCancel)===null||y===void 0||y.call(n,e,a,N)},O=function(N){var y;(y=n.onDayTouchEnd)===null||y===void 0||y.call(n,e,a,N)},$=function(N){var y;(y=n.onDayTouchMove)===null||y===void 0||y.call(n,e,a,N)},xe=function(N){var y;(y=n.onDayTouchStart)===null||y===void 0||y.call(n,e,a,N)},Ot=function(N){var y;(y=n.onDayKeyUp)===null||y===void 0||y.call(n,e,a,N)},Tt=function(N){var y;switch(N.key){case"ArrowLeft":N.preventDefault(),N.stopPropagation(),n.dir==="rtl"?l():c();break;case"ArrowRight":N.preventDefault(),N.stopPropagation(),n.dir==="rtl"?c():l();break;case"ArrowDown":N.preventDefault(),N.stopPropagation(),d();break;case"ArrowUp":N.preventDefault(),N.stopPropagation(),u();break;case"PageUp":N.preventDefault(),N.stopPropagation(),N.shiftKey?g():h();break;case"PageDown":N.preventDefault(),N.stopPropagation(),N.shiftKey?m():f();break;case"Home":N.preventDefault(),N.stopPropagation(),j();break;case"End":N.preventDefault(),N.stopPropagation(),p();break}(y=n.onDayKeyDown)===null||y===void 0||y.call(n,e,a,N)},Pt={onClick:D,onFocus:M,onBlur:A,onKeyDown:Tt,onKeyUp:Ot,onMouseEnter:L,onMouseLeave:R,onPointerEnter:S,onPointerLeave:w,onTouchCancel:E,onTouchEnd:O,onTouchMove:$,onTouchStart:xe};return Pt}function Kn(){var e=C(),a=St(),n=qe(),s=ze(),r=he(e)?a.selected:ae(e)?n.selected:ne(e)?s.selected:void 0;return r}function Gn(e){return Object.values(Y).includes(e)}function Qn(e,a){var n=[e.classNames.day];return Object.keys(a).forEach(function(s){var r=e.modifiersClassNames[s];if(r)n.push(r);else if(Gn(s)){var o=e.classNames["day_".concat(s)];o&&n.push(o)}}),n}function Zn(e,a){var n=_({},e.styles.day);return Object.keys(a).forEach(function(s){var r;n=_(_({},n),(r=e.modifiersStyles)===null||r===void 0?void 0:r[s])}),n}function Jn(e,a,n){var s,r,o,i=C(),l=Ue(),c=$n(e,a),d=Un(e,c),u=Kn(),v=!!(i.onDayClick||i.mode!=="default");b.useEffect(function(){var L;c.outside||l.focusedDay&&v&&P(l.focusedDay,e)&&((L=n.current)===null||L===void 0||L.focus())},[l.focusedDay,e,n,v,c.outside]);var x=Qn(i,c).join(" "),h=Zn(i,c),f=!!(c.outside&&!i.showOutsideDays||c.hidden),g=(o=(r=i.components)===null||r===void 0?void 0:r.DayContent)!==null&&o!==void 0?o:yn,m=t.jsx(g,{date:e,displayMonth:a,activeModifiers:c}),j={style:h,className:x,children:m,role:"gridcell"},p=l.focusTarget&&P(l.focusTarget,e)&&!c.outside,D=l.focusedDay&&P(l.focusedDay,e),M=_(_(_({},j),(s={disabled:c.disabled,role:"gridcell"},s["aria-selected"]=c.selected,s.tabIndex=D||p?0:-1,s)),d),A={isButton:v,isHidden:f,activeModifiers:c,selectedDays:u,buttonProps:M,divProps:j};return A}function Xn(e){var a=b.useRef(null),n=Jn(e.date,e.displayMonth,a);return n.isHidden?t.jsx("div",{role:"gridcell"}):n.isButton?t.jsx(ve,_({name:"day",ref:a},n.buttonProps)):t.jsx("div",_({},n.divProps))}function es(e){var a=e.number,n=e.dates,s=C(),r=s.onWeekNumberClick,o=s.styles,i=s.classNames,l=s.locale,c=s.labels.labelWeekNumber,d=s.formatters.formatWeekNumber,u=d(Number(a),{locale:l});if(!r)return t.jsx("span",{className:i.weeknumber,style:o.weeknumber,children:u});var v=c(Number(a),{locale:l}),x=function(h){r(a,n,h)};return t.jsx(ve,{name:"week-number","aria-label":v,className:i.weeknumber,style:o.weeknumber,onClick:x,children:u})}function ts(e){var a,n,s=C(),r=s.styles,o=s.classNames,i=s.showWeekNumber,l=s.components,c=(a=l==null?void 0:l.Day)!==null&&a!==void 0?a:Xn,d=(n=l==null?void 0:l.WeekNumber)!==null&&n!==void 0?n:es,u;return i&&(u=t.jsx("td",{className:o.cell,style:r.cell,children:t.jsx(d,{number:e.weekNumber,dates:e.dates})})),t.jsxs("tr",{className:o.row,style:r.row,children:[u,e.dates.map(function(v){return t.jsx("td",{className:o.cell,style:r.cell,role:"presentation",children:t.jsx(c,{displayMonth:e.displayMonth,date:v})},wa(v))})]})}function it(e,a,n){for(var s=n!=null&&n.ISOWeek?gt(a):Re(a,n),r=n!=null&&n.ISOWeek?Ae(e):ee(e,n),o=q(s,r),i=[],l=0;l<=o;l++)i.push(T(r,l));var c=i.reduce(function(d,u){var v=n!=null&&n.ISOWeek?na(u):sa(u,n),x=d.find(function(h){return h.weekNumber===v});return x?(x.dates.push(u),d):(d.push({weekNumber:v,dates:[u]}),d)},[]);return c}function as(e,a){var n=it(F(e),Be(e),a);if(a!=null&&a.useFixedWeeks){var s=Da(e,a);if(s<6){var r=n[n.length-1],o=r.dates[r.dates.length-1],i=Te(o,6-s),l=it(Te(o,1),i,a);n.push.apply(n,l)}}return n}function ns(e){var a,n,s,r=C(),o=r.locale,i=r.classNames,l=r.styles,c=r.hideHead,d=r.fixedWeeks,u=r.components,v=r.weekStartsOn,x=r.firstWeekContainsDate,h=r.ISOWeek,f=as(e.displayMonth,{useFixedWeeks:!!d,ISOWeek:h,locale:o,weekStartsOn:v,firstWeekContainsDate:x}),g=(a=u==null?void 0:u.Head)!==null&&a!==void 0?a:gn,m=(n=u==null?void 0:u.Row)!==null&&n!==void 0?n:ts,j=(s=u==null?void 0:u.Footer)!==null&&s!==void 0?s:hn;return t.jsxs("table",{id:e.id,className:i.table,style:l.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!c&&t.jsx(g,{}),t.jsx("tbody",{className:i.tbody,style:l.tbody,children:f.map(function(p){return t.jsx(m,{displayMonth:e.displayMonth,dates:p.dates,weekNumber:p.weekNumber},p.weekNumber)})}),t.jsx(j,{displayMonth:e.displayMonth})]})}function ss(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var rs=ss()?b.useLayoutEffect:b.useEffect,Me=!1,os=0;function lt(){return"react-day-picker-".concat(++os)}function is(e){var a,n=e??(Me?lt():null),s=b.useState(n),r=s[0],o=s[1];return rs(function(){r===null&&o(lt())},[]),b.useEffect(function(){Me===!1&&(Me=!0)},[]),(a=e??r)!==null&&a!==void 0?a:void 0}function ls(e){var a,n,s=C(),r=s.dir,o=s.classNames,i=s.styles,l=s.components,c=se().displayMonths,d=is(s.id?"".concat(s.id,"-").concat(e.displayIndex):void 0),u=s.id?"".concat(s.id,"-grid-").concat(e.displayIndex):void 0,v=[o.month],x=i.month,h=e.displayIndex===0,f=e.displayIndex===c.length-1,g=!h&&!f;r==="rtl"&&(a=[h,f],f=a[0],h=a[1]),h&&(v.push(o.caption_start),x=_(_({},x),i.caption_start)),f&&(v.push(o.caption_end),x=_(_({},x),i.caption_end)),g&&(v.push(o.caption_between),x=_(_({},x),i.caption_between));var m=(n=l==null?void 0:l.Caption)!==null&&n!==void 0?n:vn;return t.jsxs("div",{className:v.join(" "),style:x,children:[t.jsx(m,{id:d,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),t.jsx(ns,{id:u,"aria-labelledby":d,displayMonth:e.displayMonth})]},e.displayIndex)}function cs(e){var a=C(),n=a.classNames,s=a.styles;return t.jsx("div",{className:n.months,style:s.months,children:e.children})}function ds(e){var a,n,s=e.initialProps,r=C(),o=Ue(),i=se(),l=b.useState(!1),c=l[0],d=l[1];b.useEffect(function(){r.initialFocus&&o.focusTarget&&(c||(o.focus(o.focusTarget),d(!0)))},[r.initialFocus,c,o.focus,o.focusTarget,o]);var u=[r.classNames.root,r.className];r.numberOfMonths>1&&u.push(r.classNames.multiple_months),r.showWeekNumber&&u.push(r.classNames.with_weeknumber);var v=_(_({},r.styles.root),r.style),x=Object.keys(s).filter(function(f){return f.startsWith("data-")}).reduce(function(f,g){var m;return _(_({},f),(m={},m[g]=s[g],m))},{}),h=(n=(a=s.components)===null||a===void 0?void 0:a.Months)!==null&&n!==void 0?n:cs;return t.jsx("div",_({className:u.join(" "),style:v,dir:r.dir,id:r.id,nonce:s.nonce,title:s.title,lang:s.lang},x,{children:t.jsx(h,{children:i.displayMonths.map(function(f,g){return t.jsx(ls,{displayIndex:g,displayMonth:f},g)})})}))}function us(e){var a=e.children,n=La(e,["children"]);return t.jsx(Xa,{initialProps:n,children:t.jsx(dn,{children:t.jsx(zn,{initialProps:n,children:t.jsx(bn,{initialProps:n,children:t.jsx(Nn,{initialProps:n,children:t.jsx(Tn,{children:t.jsx(qn,{children:a})})})})})})})}function ms(e){return t.jsx(us,_({},e,{children:t.jsx(ds,{initialProps:e})}))}function Fe({className:e,classNames:a,showOutsideDays:n=!0,...s}){return t.jsx(ms,{showOutsideDays:n,className:Q("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:Q(Ge({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:Q(Ge({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:({...r})=>t.jsx(Vt,{className:"h-4 w-4"}),IconRight:({...r})=>t.jsx(It,{className:"h-4 w-4"})},...s})}Fe.displayName="Calendar";const U={delivered:{label:"LivrÃ©e",color:"bg-green-500/20 text-green-700 dark:text-green-300"},cancelled:{label:"AnnulÃ©e",color:"bg-red-500/20 text-red-700 dark:text-red-300"}},fs=({orders:e})=>{const[a,n]=b.useState(""),[s,r]=b.useState("all"),[o,i]=b.useState(),[l,c]=b.useState(),[d,u]=b.useState(""),[v,x]=b.useState(""),h=b.useMemo(()=>e.filter(p=>{const D=p.name.toLowerCase().includes(a.toLowerCase())||p.phone.includes(a),M=s==="all"||p.status===s,A=new Date(p.heure_de_commande),L=!o||A>=o,R=!l||A<=new Date(l.getTime()+864e5),S=!d||p.price_total>=parseFloat(d),w=!v||p.price_total<=parseFloat(v);return D&&M&&L&&R&&S&&w}),[e,a,s,o,l,d,v]),f=a||s!=="all"||o||l||d||v,g=()=>{n(""),r("all"),i(void 0),c(void 0),u(""),x("")},m=p=>{try{return W(new Date(p),"dd MMM yyyy, HH:mm",{locale:Oe})}catch{return p}},j=()=>{const p=["Date","Client","TÃ©lÃ©phone","Montant","Statut"],D=h.map(S=>{var w;return[m(S.heure_de_commande),S.name||"N/A",S.phone||"N/A",S.price_total.toFixed(2).replace(".",","),((w=U[S.status])==null?void 0:w.label)||S.status]}),A="\uFEFF"+[p.join(";"),...D.map(S=>S.map(w=>`"${String(w).replace(/"/g,'""')}"`).join(";"))].join(`\r
`),L=new Blob([A],{type:"text/csv;charset=utf-8;"}),R=document.createElement("a");R.href=URL.createObjectURL(L),R.download=`commandes_${W(new Date,"yyyy-MM-dd")}.csv`,R.click()};return t.jsxs(V,{children:[t.jsx(J,{className:"px-4 md:px-6",children:t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[t.jsxs(me,{className:"flex items-center gap-2 text-lg md:text-xl",children:["Historique des commandes",t.jsx(G,{variant:"secondary",children:h.length})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[f&&t.jsxs(I,{variant:"ghost",size:"sm",onClick:g,className:"text-xs md:text-sm",children:[t.jsx(ma,{className:"h-4 w-4 mr-1"}),t.jsx("span",{className:"hidden sm:inline",children:"RÃ©initialiser"})]}),t.jsxs(I,{variant:"outline",size:"sm",onClick:j,disabled:h.length===0,className:"text-xs md:text-sm",children:[t.jsx(fa,{className:"h-4 w-4 sm:mr-1"}),t.jsx("span",{className:"hidden sm:inline",children:"Export CSV"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:flex md:flex-wrap gap-2",children:[t.jsxs("div",{className:"relative col-span-2 sm:col-span-1 sm:w-48",children:[t.jsx(va,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),t.jsx(de,{placeholder:"Rechercher...",value:a,onChange:p=>n(p.target.value),className:"pl-8 h-9"})]}),t.jsxs(la,{value:s,onValueChange:r,children:[t.jsx(ca,{className:"w-full sm:w-36 h-9",children:t.jsx(da,{placeholder:"Statut"})}),t.jsxs(ua,{children:[t.jsx(be,{value:"all",children:"Tous"}),t.jsx(be,{value:"delivered",children:"LivrÃ©es"}),t.jsx(be,{value:"cancelled",children:"AnnulÃ©es"})]})]}),t.jsxs(Je,{children:[t.jsx(Xe,{asChild:!0,children:t.jsxs(I,{variant:"outline",size:"sm",className:Q("h-9 w-full sm:w-36 justify-start text-left font-normal",!o&&"text-muted-foreground"),children:[t.jsx(ce,{className:"mr-2 h-4 w-4"}),o?W(o,"dd/MM/yyyy"):"Du"]})}),t.jsx(et,{className:"w-auto p-0",align:"start",children:t.jsx(Fe,{mode:"single",selected:o,onSelect:i,initialFocus:!0,className:"pointer-events-auto"})})]}),t.jsxs(Je,{children:[t.jsx(Xe,{asChild:!0,children:t.jsxs(I,{variant:"outline",size:"sm",className:Q("h-9 w-full sm:w-36 justify-start text-left font-normal",!l&&"text-muted-foreground"),children:[t.jsx(ce,{className:"mr-2 h-4 w-4"}),l?W(l,"dd/MM/yyyy"):"Au"]})}),t.jsx(et,{className:"w-auto p-0",align:"start",children:t.jsx(Fe,{mode:"single",selected:l,onSelect:c,initialFocus:!0,className:"pointer-events-auto"})})]}),t.jsx(de,{type:"number",placeholder:"Min â‚¬",value:d,onChange:p=>u(p.target.value),className:"w-full sm:w-24 h-9"}),t.jsx(de,{type:"number",placeholder:"Max â‚¬",value:v,onChange:p=>x(p.target.value),className:"w-full sm:w-24 h-9"})]})]})}),t.jsx(X,{className:"px-2 md:px-6",children:h.length===0?t.jsx("div",{className:"text-center py-8 text-muted-foreground",children:f?"Aucune commande trouvÃ©e avec ces filtres":"Aucune commande dans l'historique"}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"hidden md:block overflow-x-auto",children:t.jsxs(ra,{children:[t.jsx(oa,{children:t.jsxs(Ze,{children:[t.jsx(ie,{children:"Client"}),t.jsx(ie,{children:"Date"}),t.jsx(ie,{children:"Montant"}),t.jsx(ie,{children:"Statut"})]})}),t.jsx(ia,{children:h.map(p=>{var D,M;return t.jsxs(Ze,{children:[t.jsx(le,{children:t.jsxs("div",{children:[t.jsx("div",{className:"font-medium truncate max-w-[150px]",children:p.name}),t.jsx("div",{className:"text-sm text-muted-foreground",children:p.phone})]})}),t.jsx(le,{className:"text-sm whitespace-nowrap",children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(ce,{className:"h-3 w-3 shrink-0"}),m(p.heure_de_commande)]})}),t.jsxs(le,{className:"font-semibold whitespace-nowrap",children:[p.price_total.toFixed(2),"â‚¬"]}),t.jsx(le,{children:t.jsx(G,{className:((D=U[p.status])==null?void 0:D.color)||"",children:((M=U[p.status])==null?void 0:M.label)||p.status})})]},p.id)})})]})}),t.jsx("div",{className:"md:hidden space-y-3",children:h.map(p=>{var D,M;return t.jsx(V,{className:"p-3",children:t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("div",{className:"font-medium truncate",children:p.name}),t.jsx("div",{className:"text-xs text-muted-foreground",children:p.phone}),t.jsxs("div",{className:"text-xs text-muted-foreground mt-1 flex items-center gap-1",children:[t.jsx(ce,{className:"h-3 w-3"}),m(p.heure_de_commande)]})]}),t.jsxs("div",{className:"text-right shrink-0",children:[t.jsxs("div",{className:"font-semibold",children:[p.price_total.toFixed(2),"â‚¬"]}),t.jsx(G,{className:`${((D=U[p.status])==null?void 0:D.color)||""} text-xs mt-1`,children:((M=U[p.status])==null?void 0:M.label)||p.status})]})]})},p.id)})})]})})]})},vs=({todayOrders:e,todayRevenue:a,averagePreparationTime:n})=>{const s=e.filter(i=>i.status==="delivered").length,r=e.filter(i=>["pending","confirmed","preparing","ready"].includes(i.status)).length,o=[{title:"Commandes du jour",value:e.length,subtitle:`${s} livrÃ©es, ${r} en cours`,icon:ke,color:"text-blue-500",bgColor:"bg-blue-500/10"},{title:"CA du jour",value:`${a.toFixed(2)}â‚¬`,subtitle:`Moyenne: ${e.length>0?(a/e.length).toFixed(2):"0.00"}â‚¬ / commande`,icon:Ut,color:"text-green-500",bgColor:"bg-green-500/10"},{title:"Temps moyen",value:`${n} min`,subtitle:"De confirmation Ã  prÃªt",icon:ha,color:"text-purple-500",bgColor:"bg-purple-500/10"},{title:"Performance",value:`${s>0?Math.round(s/e.length*100):0}%`,subtitle:"Taux de complÃ©tion",icon:Wt,color:"text-amber-500",bgColor:"bg-amber-500/10"}];return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:o.map(i=>{const l=i.icon;return t.jsxs(V,{children:[t.jsxs(J,{className:"flex flex-row items-center justify-between pb-2",children:[t.jsx(me,{className:"text-sm font-medium text-muted-foreground",children:i.title}),t.jsx("div",{className:`p-2 rounded-lg ${i.bgColor}`,children:t.jsx(l,{className:`h-4 w-4 ${i.color}`})})]}),t.jsxs(X,{children:[t.jsx("div",{className:"text-2xl font-bold",children:i.value}),t.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i.subtitle})]})]},i.title)})}),t.jsxs(V,{children:[t.jsx(J,{children:t.jsx(me,{children:"RÃ©partition par type de commande (aujourd'hui)"})}),t.jsx(X,{children:t.jsx("div",{className:"grid grid-cols-3 gap-4",children:["scheduled_takeaway","immediate_takeaway","delivery"].map(i=>{const l=e.filter(u=>u.commande_type===i).length,c=e.length>0?Math.round(l/e.length*100):0,d={scheduled_takeaway:"ProgrammÃ©",immediate_takeaway:"ImmÃ©diat",delivery:"Livraison"};return t.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg",children:[t.jsx("div",{className:"text-2xl font-bold",children:l}),t.jsx("div",{className:"text-sm text-muted-foreground",children:d[i]}),t.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[c,"%"]})]},i)})})})]})]})};function hs(e){const{data:a,isLoading:n}=Se({queryKey:["order-reviews",e],queryFn:async()=>{if(!e)return[];const{data:r,error:o}=await K.from("order_reviews").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(50);if(o)throw o;return r},enabled:!!e}),s={averageRating:a&&a.length>0?a.reduce((r,o)=>r+o.rating,0)/a.length:0,totalReviews:(a==null?void 0:a.length)||0,recentReviews:(a==null?void 0:a.slice(0,5))||[]};return{reviews:a,stats:s,isLoading:n}}function xs({userId:e}){const{stats:a,isLoading:n}=hs(e),{settings:s,updateSettings:r}=xt(e),[o,i]=b.useState(!1),[l,c]=b.useState(2),[d,u]=b.useState("");b.useEffect(()=>{s&&(i(s.customer_reviews_enabled??!1),c(s.customer_reviews_delay_hours??2),u(s.customer_reviews_message??""))},[s]);const v=()=>{r({customer_reviews_enabled:o,customer_reviews_delay_hours:l,customer_reviews_message:d})},x=h=>Array.from({length:5},(f,g)=>g<h?t.jsx(je,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"},g):t.jsx(Kt,{className:"w-4 h-4 text-muted"},g));return t.jsxs(V,{children:[t.jsxs(J,{className:"px-4 md:px-6",children:[t.jsxs(me,{className:"flex items-center gap-2 text-base md:text-lg",children:[t.jsx(je,{className:"w-4 h-4 md:w-5 md:h-5"}),"Collecte d'avis clients"]}),t.jsx(At,{className:"text-xs md:text-sm",children:"Collectez automatiquement les avis aprÃ¨s les commandes"})]}),t.jsxs(X,{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx(Z,{children:"Activer la collecte d'avis"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Le chatbot demandera un avis aprÃ¨s chaque commande"})]}),t.jsx(xa,{checked:o,onCheckedChange:i})]}),o&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(Z,{htmlFor:"delay-hours",children:"DÃ©lai aprÃ¨s commande (heures)"}),t.jsx(de,{id:"delay-hours",type:"number",min:"1",max:"48",value:l,onChange:h=>c(parseInt(h.target.value)||2),className:"max-w-[200px]"}),t.jsxs("p",{className:"text-sm text-muted-foreground",children:["Le client recevra le message ",l,"h aprÃ¨s sa commande"]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Z,{htmlFor:"review-message",children:"Message personnalisÃ©"}),t.jsx(Ee,{id:"review-message",value:d,onChange:h=>u(h.target.value),placeholder:"Comment avez-vous trouvÃ© votre commande ?",className:"min-h-[80px]"})]})]}),!n&&a.totalReviews>0&&t.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h4",{className:"font-semibold",children:"AperÃ§u des avis rÃ©cents"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-2xl font-bold",children:a.averageRating.toFixed(1)}),t.jsx(je,{className:"w-5 h-5 fill-yellow-400 text-yellow-400"}),t.jsxs("span",{className:"text-sm text-muted-foreground",children:["(",a.totalReviews," avis)"]})]})]}),t.jsx(pa,{className:"h-[200px] pr-4",children:t.jsx("div",{className:"space-y-3",children:a.recentReviews.map(h=>t.jsxs("div",{className:"p-3 rounded-lg border bg-card",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[x(h.rating),t.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(h.created_at).toLocaleDateString("fr-FR")})]}),h.comment&&t.jsxs("p",{className:"text-sm text-muted-foreground italic",children:['"',h.comment,'"']})]},h.id))})})]}),t.jsx(I,{onClick:v,className:"w-full",children:"Enregistrer les paramÃ¨tres"})]})]})}const ps=({userId:e})=>{const[a,n]=b.useState("current"),{profile:s}=Le(),r=e??(s==null?void 0:s.user_id),{canAccessOrderStats:o,canAccessCustomerReviews:i}=Rt(),{isLoading:l,products:c,getPendingOrders:d,getTodayOrders:u,getOrdersHistory:v,getTodayRevenue:x,getAveragePreparationTime:h,updateOrderStatus:f,isUpdating:g}=ka(r),{settings:m}=xt(r),{integration:j}=ga(r),p=d(),D=[...d(),...v()],{notificationEnabled:M,toggleNotification:A}=Oa(D),L=u(),R=v(),S=x(),w=h(),E=2+(o?1:0)+(i?1:0);return l?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx(Ie,{className:"h-8 w-8 animate-spin text-primary"})}):t.jsx("div",{className:"space-y-6",children:t.jsxs(Bt,{value:a,onValueChange:O=>n(O),children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-2",children:[t.jsxs(Yt,{className:`flex flex-wrap h-auto gap-1 w-full sm:max-w-lg sm:flex-nowrap ${E===2?"sm:grid sm:grid-cols-2":E===3?"sm:grid sm:grid-cols-3":"sm:grid sm:grid-cols-4"}`,children:[t.jsxs(re,{value:"current",className:"relative text-sm",children:[t.jsx("span",{className:"hidden sm:inline",children:"En cours"}),t.jsx("span",{className:"sm:hidden",children:"En cours"}),p.length>0&&t.jsx(G,{className:"ml-1 sm:ml-2 bg-primary text-xs",variant:"default",children:p.length})]}),t.jsx(re,{value:"history",className:"text-sm",children:"Historique"}),o&&t.jsxs(re,{value:"stats",className:"text-sm",children:[t.jsx("span",{className:"hidden sm:inline",children:"Statistiques"}),t.jsx("span",{className:"sm:hidden",children:"Stats"})]}),i&&t.jsxs(re,{value:"reviews",className:"text-sm",children:[t.jsx("span",{className:"hidden sm:inline",children:"Avis Clients"}),t.jsx("span",{className:"sm:hidden",children:"Avis"})]})]}),t.jsx(I,{variant:"outline",size:"sm",onClick:A,className:"shrink-0 w-full sm:w-auto",title:M?"DÃ©sactiver les notifications sonores":"Activer les notifications sonores",children:M?t.jsxs(t.Fragment,{children:[t.jsx(Gt,{className:"h-4 w-4 mr-1"})," ",t.jsx("span",{children:"Son activÃ©"})]}):t.jsxs(t.Fragment,{children:[t.jsx(Qt,{className:"h-4 w-4 mr-1"})," ",t.jsx("span",{children:"Son dÃ©sactivÃ©"})]})})]}),t.jsx(oe,{value:"current",className:"space-y-4 mt-6",children:p.length===0?t.jsxs("div",{className:"text-center py-12",children:[t.jsx(Zt,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Aucune commande en cours"}),t.jsx("p",{className:"text-muted-foreground",children:"Les nouvelles commandes apparaÃ®tront ici"})]}):t.jsx("div",{className:"grid gap-4",children:p.map(O=>t.jsx(Fa,{order:O,onUpdateStatus:($,xe)=>f({orderId:$,newStatus:xe}),isUpdating:g,manualOrderConfirmation:(m==null?void 0:m.manual_order_confirmation)??!1,restaurantName:(m==null?void 0:m.restaurant_name)??"",restaurantPhone:(j==null?void 0:j.display_phone_number)??"",phoneNumberId:(j==null?void 0:j.phone_number_id)??(m==null?void 0:m.phone_number_id)??"",whatsappBusinessId:(j==null?void 0:j.waba_id)??(m==null?void 0:m.whatsapp_business_id)??"",accessToken:(j==null?void 0:j.access_token)??(m==null?void 0:m.whatsapp_access_token)??"",userId:r??"",products:c},O.id))})}),t.jsx(oe,{value:"history",className:"mt-6",children:t.jsx(fs,{orders:R})}),o&&t.jsx(oe,{value:"stats",className:"mt-6",children:t.jsx(vs,{todayOrders:L,todayRevenue:S,averagePreparationTime:w})}),i&&t.jsx(oe,{value:"reviews",className:"mt-6",children:t.jsx(xs,{userId:r})})]})})},Vs=()=>{const{profile:e}=Le();return t.jsxs("div",{className:"container mx-auto p-4 md:p-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-2xl md:text-3xl font-bold",children:"Commandes"}),t.jsx("p",{className:"text-muted-foreground mt-2",children:"GÃ©rez vos commandes"})]}),t.jsx(ps,{userId:e==null?void 0:e.user_id})]})};export{Vs as default};
