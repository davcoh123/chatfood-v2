var K=r=>{throw TypeError(r)};var C=(r,t,s)=>t.has(r)||K("Cannot "+s);var i=(r,t,s)=>(C(r,t,"read from private field"),s?s.call(r):t.get(r)),v=(r,t,s)=>t.has(r)?K("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,s),_=(r,t,s,e)=>(C(r,t,"write to private field"),e?e.call(r,s):t.set(r,s),s),S=(r,t,s)=>(C(r,t,"access private method"),s);import{u as F}from"./useQuery.js";import{b4 as I,b5 as L,b6 as x,b7 as Q,b8 as j,l as U,r as w,b9 as k,ba as A,d as D,m as P,s as M}from"./index.js";var c,m,n,l,d,O,q,R,B=(R=class extends I{constructor(t,s){super();v(this,d);v(this,c);v(this,m);v(this,n);v(this,l);_(this,c,t),this.setOptions(s),this.bindMethods(),S(this,d,O).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var e;const s=this.options;this.options=i(this,c).defaultMutationOptions(t),L(this.options,s)||i(this,c).getMutationCache().notify({type:"observerOptionsUpdated",mutation:i(this,n),observer:this}),s!=null&&s.mutationKey&&this.options.mutationKey&&x(s.mutationKey)!==x(this.options.mutationKey)?this.reset():((e=i(this,n))==null?void 0:e.state.status)==="pending"&&i(this,n).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=i(this,n))==null||t.removeObserver(this)}onMutationUpdate(t){S(this,d,O).call(this),S(this,d,q).call(this,t)}getCurrentResult(){return i(this,m)}reset(){var t;(t=i(this,n))==null||t.removeObserver(this),_(this,n,void 0),S(this,d,O).call(this),S(this,d,q).call(this)}mutate(t,s){var e;return _(this,l,s),(e=i(this,n))==null||e.removeObserver(this),_(this,n,i(this,c).getMutationCache().build(i(this,c),this.options)),i(this,n).addObserver(this),i(this,n).execute(t)}},c=new WeakMap,m=new WeakMap,n=new WeakMap,l=new WeakMap,d=new WeakSet,O=function(){var s;const t=((s=i(this,n))==null?void 0:s.state)??Q();_(this,m,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},q=function(t){j.batch(()=>{var s,e,u,p,h,o,g,f;if(i(this,l)&&this.hasListeners()){const a=i(this,m).variables,y=i(this,m).context,E={client:i(this,c),meta:this.options.meta,mutationKey:this.options.mutationKey};if((t==null?void 0:t.type)==="success"){try{(e=(s=i(this,l)).onSuccess)==null||e.call(s,t.data,a,y,E)}catch(b){Promise.reject(b)}try{(p=(u=i(this,l)).onSettled)==null||p.call(u,t.data,null,a,y,E)}catch(b){Promise.reject(b)}}else if((t==null?void 0:t.type)==="error"){try{(o=(h=i(this,l)).onError)==null||o.call(h,t.error,a,y,E)}catch(b){Promise.reject(b)}try{(f=(g=i(this,l)).onSettled)==null||f.call(g,void 0,t.error,a,y,E)}catch(b){Promise.reject(b)}}}this.listeners.forEach(a=>{a(i(this,m))})})},R);function T(r,t){const s=U(),[e]=w.useState(()=>new B(s,r));w.useEffect(()=>{e.setOptions(r)},[e,r]);const u=w.useSyncExternalStore(w.useCallback(h=>e.subscribe(j.batchCalls(h)),[e]),()=>e.getCurrentResult(),()=>e.getCurrentResult()),p=w.useCallback((h,o)=>{e.mutate(h,o).catch(k)},[e]);if(u.error&&A(e.options.throwOnError,[u.error]))throw u.error;return{...u,mutate:p,mutateAsync:u.mutate}}function J(r){const t=U(),{user:s}=D(),e=r??(s==null?void 0:s.id),{data:u,isLoading:p}=F({queryKey:["restaurant-settings",e],queryFn:async()=>{if(!e)return null;const{data:o,error:g}=await M.from("restaurant_settings").select("*").eq("user_id",e).maybeSingle();if(g)throw g;if(!o){const f={user_id:e,chatbot_name:"ChatFood Bot",chatbot_active:!1,opening_hours:[{day:"lundi",slot1:"",slot2:""},{day:"mardi",slot1:"",slot2:""},{day:"mercredi",slot1:"",slot2:""},{day:"jeudi",slot1:"",slot2:""},{day:"vendredi",slot1:"",slot2:""},{day:"samedi",slot1:"",slot2:""},{day:"dimanche",slot1:"",slot2:""}]},{data:a,error:y}=await M.from("restaurant_settings").insert(f).select().single();if(y)throw y;return{...a,opening_hours:a.opening_hours,assets:a.assets||[]}}return{...o,opening_hours:o.opening_hours,assets:o.assets||[]}},enabled:!!e}),h=T({mutationFn:async o=>{if(!e)throw new Error("User ID required");const g={...o,opening_hours:o.opening_hours,assets:o.assets,product_suggestions:o.product_suggestions,daily_menu_config:o.daily_menu_config},{data:f,error:a}=await M.from("restaurant_settings").update(g).eq("user_id",e).select().single();if(a)throw a;return f},onSuccess:()=>{t.invalidateQueries({queryKey:["restaurant-settings",e]}),P.success("Paramètres enregistrés avec succès")},onError:o=>{P.error("Erreur lors de la sauvegarde",{description:o.message})}});return{settings:u,isLoading:p,updateSettings:h.mutate,isUpdating:h.isPending}}export{T as a,J as u};
