import{u as f}from"./useQuery.js";import{l as m,d as v,m as n,s as c}from"./index.js";import{a as l}from"./useRestaurantSettings.js";const q=o=>{const u=m(),{profile:i}=v(),e=(o==null?void 0:o.userId)??(i==null?void 0:i.user_id),{data:y,isLoading:p,error:_}=f({queryKey:["catalogue-items",e],queryFn:async()=>{if(!e)return[];const{data:s,error:a}=await c.from("products").select("*").eq("user_id",e).order("category").order("sort_order").order("name");if(a)throw console.error("Error fetching catalogue:",a),a;return(s||[]).map(r=>({id:r.id,name:r.name,ingredient:r.ingredient||[],category:r.category,description:r.description||"",unit_price:r.unit_price,currency:r.currency||"EUR",vat_rate:r.vat_rate||10,is_active:r.is_active,tags:r.tags||[],allergens:r.allergens||[]}))},enabled:!!e}),d=l({mutationFn:async s=>{if(!e)throw new Error("Utilisateur non connecté");const a=s.map(t=>({id:t.id,user_id:e,name:t.name,ingredient:t.ingredient,category:t.category,description:t.description,unit_price:t.unit_price,currency:t.currency,vat_rate:t.vat_rate,is_active:t.is_active,tags:t.tags,allergens:t.allergens,updated_at:new Date().toISOString()})),{error:r}=await c.from("products").upsert(a,{onConflict:"id"});if(r)throw r},onSuccess:()=>{n.success("Modifications enregistrées"),u.invalidateQueries({queryKey:["catalogue-items",e]})},onError:s=>{n.error(`Erreur: ${s.message}`)}}),g=l({mutationFn:async s=>{if(!e)throw new Error("Utilisateur non connecté");const{error:a}=await c.from("products").delete().eq("id",s.id).eq("user_id",e);if(a)throw a},onSuccess:()=>{n.success("Produit supprimé"),u.invalidateQueries({queryKey:["catalogue-items",e]})},onError:s=>{n.error(`Erreur: ${s.message}`)}});return{items:y||[],isLoading:p,error:_,hasConfig:!!e,saveItems:d.mutate,isSaving:d.isPending,deleteItem:g.mutate,isDeleting:g.isPending}};export{q as u};
