import{r as a,j as e,D as ce,n as de,o as ue,p as me,q as pe,I as B,t as Ee,B as I,s as b,m as _,e as oe,Q as ze,V as cr,W as ct,Y as dr,Z as ur,$ as dt,a0 as ut,a1 as De,a2 as mt,a3 as te,a4 as fe,a5 as C,a6 as pt,a7 as ft,a8 as ht,a9 as xt,aa as gt,ab as vt,ac as jt,ad as wt,ae as _t,af as nr,v as V,w as yt,C as ve,a as je,b as we,c as _e,g as bt,H as Ct}from"./index.js";import{L}from"./label.js";import{S as be,a as Ce,b as Ne,c as Me,d as $}from"./select.js";import{u as Ve,t as qe}from"./zod.js";import{o as q,e as $e,s as P,b as ye,n as sr}from"./types.js";import{P as mr}from"./PasswordStrengthIndicator.js";import{C as ar}from"./ConfirmDialog.js";import{S as Nt}from"./switch.js";import{L as Ge,C as Mt,E as St,S as Rt,U as or,K as Et,B as Dt}from"./user-cog.js";import{L as ir}from"./loader-circle.js";import{C as Pt}from"./copy.js";import{E as kt}from"./external-link.js";import{T as Be}from"./trash-2.js";import{T as It,a as At,b as Fe,c as re,d as Tt,e as W}from"./table.js";import{u as Lt}from"./index3.js";import{c as pr,I as Ot,R as Ft}from"./index2.js";import{C as $t}from"./check.js";import{U as Gt}from"./user-plus.js";import{S as Bt}from"./search.js";import{M as Ut}from"./mail.js";import{C as Kt}from"./calendar.js";import"./index4.js";import"./index5.js";import"./progress.js";import"./circle-alert.js";import"./alert-dialog.js";const zt=q({email:P().min(1,"L'email est requis").email("Format d'email invalide").max(255,"L'email ne peut pas dépasser 255 caractères"),password:P().min(8,"Le mot de passe doit contenir au moins 8 caractères").max(72,"Le mot de passe ne peut pas dépasser 72 caractères").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&#+\-=<>{}[\]|~^.,;:_°])[A-Za-z\d@$!%*?&#+\-=<>{}[\]|~^.,;:_°]+$/,"Le mot de passe doit contenir au moins: 1 minuscule, 1 majuscule, 1 chiffre et 1 caractère spécial"),first_name:P().max(100,"Le prénom ne peut pas dépasser 100 caractères").optional(),last_name:P().max(100,"Le nom ne peut pas dépasser 100 caractères").optional(),role:$e(["admin","user"]),plan:$e(["starter","pro","premium"])});q({user_id:P().uuid("ID utilisateur invalide"),new_email:P().min(1,"L'email est requis").email("Format d'email invalide").max(255,"L'email ne peut pas dépasser 255 caractères")});q({user_id:P().uuid("ID utilisateur invalide"),first_name:P().max(100,"Le prénom ne peut pas dépasser 100 caractères").optional(),last_name:P().max(100,"Le nom ne peut pas dépasser 100 caractères").optional()});const Vt=q({first_name:P().max(100,"Le prénom ne peut pas dépasser 100 caractères").optional(),last_name:P().max(100,"Le nom ne peut pas dépasser 100 caractères").optional(),email:P().min(1,"L'email est requis").email("Format d'email invalide").max(255,"L'email ne peut pas dépasser 255 caractères")}),qt=q({new_password:P().min(8,"Le mot de passe doit contenir au moins 8 caractères").max(72,"Le mot de passe ne peut pas dépasser 72 caractères").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&#+\-=<>{}[\]|~^.,;:_°])[A-Za-z\d@$!%*?&#+\-=<>{}[\]|~^.,;:_°]+$/,"Le mot de passe doit contenir au moins: 1 minuscule, 1 majuscule, 1 chiffre et 1 caractère spécial")});q({user_id:P().uuid("ID utilisateur invalide"),new_password:P().min(8,"Le mot de passe doit contenir au moins 8 caractères").max(72,"Le mot de passe ne peut pas dépasser 72 caractères").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&#+\-=<>{}[\]|~^.,;:_°])[A-Za-z\d@$!%*?&#+\-=<>{}[\]|~^.,;:_°]+$/,"Le mot de passe doit contenir au moins: 1 minuscule, 1 majuscule, 1 chiffre et 1 caractère spécial")});q({user_id:P().uuid("ID utilisateur invalide"),action:$e(["block","unblock"]),reason:P().max(500,"La raison ne peut pas dépasser 500 caractères").optional()});q({allow_registration:ye().optional(),max_login_attempts:sr().int().min(1).max(20).optional(),block_duration_minutes:sr().int().min(1).max(1440).optional(),email_notifications_signup:ye().optional(),email_notifications_security:ye().optional(),maintenance_mode:ye().optional()});function Ht({open:r,onOpenChange:n,onSuccess:t}){const[s,o]=a.useState(!1),[i,c]=a.useState(!1),{register:d,handleSubmit:u,formState:{errors:h},setValue:g,watch:l,reset:f}=Ve({resolver:qe(zt),defaultValues:{role:"user",plan:"starter"}}),v=l("role"),w=l("plan"),M=l("password")||"",N=async S=>{o(!0);try{const{data:{session:D}}=await b.auth.getSession(),{error:T}=await b.functions.invoke("admin-create-user",{body:S,headers:{Authorization:`Bearer ${D==null?void 0:D.access_token}`}});if(T)throw T;_.success("Utilisateur créé avec succès"),f(),n(!1),t()}catch(D){console.error("Error creating user:",D),_.error(D.message||"Erreur lors de la création de l'utilisateur")}finally{o(!1)}};return e.jsx(ce,{open:r,onOpenChange:n,children:e.jsxs(de,{children:[e.jsxs(ue,{children:[e.jsx(me,{children:"Créer un utilisateur"}),e.jsx(pe,{children:"Créer un nouveau compte utilisateur avec email et mot de passe"})]}),e.jsxs("form",{onSubmit:u(N),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"email",children:"Email *"}),e.jsx(B,{id:"email",type:"email",...d("email"),placeholder:"exemple@email.com"}),h.email&&e.jsx("p",{className:"text-sm text-destructive",children:h.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"password",children:"Mot de passe *"}),e.jsx(B,{id:"password",type:"password",...d("password"),placeholder:"Mot de passe sécurisé"}),h.password&&e.jsx("p",{className:"text-sm text-destructive",children:h.password.message}),e.jsx(mr,{password:M,onValidityChange:c})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"first_name",children:"Prénom"}),e.jsx(B,{id:"first_name",...d("first_name"),placeholder:"Jean"}),h.first_name&&e.jsx("p",{className:"text-sm text-destructive",children:h.first_name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"last_name",children:"Nom"}),e.jsx(B,{id:"last_name",...d("last_name"),placeholder:"Dupont"}),h.last_name&&e.jsx("p",{className:"text-sm text-destructive",children:h.last_name.message})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"role",children:"Rôle *"}),e.jsxs(be,{value:v,onValueChange:S=>g("role",S),children:[e.jsx(Ce,{children:e.jsx(Ne,{placeholder:"Sélectionner un rôle"})}),e.jsxs(Me,{children:[e.jsx($,{value:"user",children:"Utilisateur"}),e.jsx($,{value:"admin",children:"Administrateur"})]})]}),h.role&&e.jsx("p",{className:"text-sm text-destructive",children:h.role.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"plan",children:"Plan d'abonnement *"}),e.jsxs(be,{value:w,onValueChange:S=>g("plan",S),children:[e.jsx(Ce,{children:e.jsx(Ne,{placeholder:"Sélectionner un plan"})}),e.jsxs(Me,{children:[e.jsx($,{value:"starter",children:"Starter"}),e.jsx($,{value:"pro",children:"Pro"}),e.jsx($,{value:"premium",children:"Premium"})]})]}),h.plan&&e.jsx("p",{className:"text-sm text-destructive",children:h.plan.message})]})]}),e.jsxs(Ee,{children:[e.jsx(I,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:s,children:"Annuler"}),e.jsx(I,{type:"submit",disabled:s||!i,children:s?"Création...":"Créer"})]})]})]})})}function Wt({open:r,onOpenChange:n,profile:t,onSuccess:s}){const[o,i]=a.useState(!1),{register:c,handleSubmit:d,formState:{errors:u},reset:h,setValue:g}=Ve({resolver:qe(Vt)});a.useEffect(()=>{t&&(g("first_name",t.first_name||""),g("last_name",t.last_name||""),g("email",t.email))},[t,g]);const l=async f=>{if(t){i(!0);try{const{data:{session:v}}=await b.auth.getSession(),{error:w}=await b.functions.invoke("admin-update-profile",{body:{user_id:t.user_id,first_name:f.first_name,last_name:f.last_name},headers:{Authorization:`Bearer ${v==null?void 0:v.access_token}`}});if(w)throw w;if(f.email!==t.email){const{error:N}=await b.functions.invoke("admin-update-email",{body:{user_id:t.user_id,new_email:f.email},headers:{Authorization:`Bearer ${v==null?void 0:v.access_token}`}});if(N)throw N}_.success("Profil mis à jour avec succès");const{data:{session:M}}=await b.auth.getSession();(M==null?void 0:M.user.id)===t.user_id&&window.dispatchEvent(new Event("profile-updated")),n(!1),s()}catch(v){console.error("Error updating profile:",v),_.error(v.message||"Erreur lors de la mise à jour du profil")}finally{i(!1)}}};return e.jsx(ce,{open:r,onOpenChange:n,children:e.jsxs(de,{children:[e.jsxs(ue,{children:[e.jsx(me,{children:"Modifier le profil"}),e.jsx(pe,{children:"Modifier les informations de l'utilisateur"})]}),e.jsxs("form",{onSubmit:d(l),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"email",children:"Email"}),e.jsx(B,{id:"email",type:"email",...c("email")}),u.email&&e.jsx("p",{className:"text-sm text-destructive",children:u.email.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"first_name",children:"Prénom"}),e.jsx(B,{id:"first_name",...c("first_name")}),u.first_name&&e.jsx("p",{className:"text-sm text-destructive",children:u.first_name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"last_name",children:"Nom"}),e.jsx(B,{id:"last_name",...c("last_name")}),u.last_name&&e.jsx("p",{className:"text-sm text-destructive",children:u.last_name.message})]})]}),e.jsxs(Ee,{children:[e.jsx(I,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:o,children:"Annuler"}),e.jsx(I,{type:"submit",disabled:o,children:o?"Enregistrement...":"Enregistrer"})]})]})]})})}function Yt({open:r,onOpenChange:n,userId:t,userEmail:s}){const[o,i]=a.useState(!1),[c,d]=a.useState(!1),{register:u,handleSubmit:h,formState:{errors:g},reset:l,watch:f}=Ve({resolver:qe(qt)}),v=f("new_password")||"",w=async M=>{if(t){i(!0);try{const{data:{session:N}}=await b.auth.getSession(),{error:S}=await b.functions.invoke("admin-reset-password",{body:{user_id:t,new_password:M.new_password},headers:{Authorization:`Bearer ${N==null?void 0:N.access_token}`}});if(S)throw S;_.success(`Mot de passe réinitialisé pour ${s}`),l(),n(!1)}catch(N){console.error("Error resetting password:",N),_.error(N.message||"Erreur lors de la réinitialisation du mot de passe")}finally{i(!1)}}};return e.jsx(ce,{open:r,onOpenChange:n,children:e.jsxs(de,{children:[e.jsxs(ue,{children:[e.jsx(me,{children:"Réinitialiser le mot de passe"}),e.jsxs(pe,{children:["Définir un nouveau mot de passe pour ",s]})]}),e.jsxs("form",{onSubmit:h(w),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"new_password",children:"Nouveau mot de passe"}),e.jsx(B,{id:"new_password",type:"password",...u("new_password"),placeholder:"Entrez le nouveau mot de passe"}),g.new_password&&e.jsx("p",{className:"text-sm text-destructive",children:g.new_password.message}),e.jsx(mr,{password:v,onValidityChange:d})]}),e.jsxs(Ee,{children:[e.jsx(I,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:o,children:"Annuler"}),e.jsx(I,{type:"submit",disabled:o||!c,children:o?"Réinitialisation...":"Réinitialiser"})]})]})]})})}function Xt({open:r,onOpenChange:n,userId:t,currentPlan:s,userEmail:o,onSuccess:i}){const[c,d]=a.useState(!1),[u,h]=a.useState(s),g=async l=>{if(l.preventDefault(),u===s){_.error("Le plan sélectionné est déjà actif");return}d(!0);try{const{data:{session:f}}=await b.auth.getSession(),{error:v}=await b.functions.invoke("admin-update-subscription",{body:{user_id:t,new_plan:u},headers:{Authorization:`Bearer ${f==null?void 0:f.access_token}`}});if(v)throw v;_.success(`Plan mis à jour vers ${u.toUpperCase()} pour ${o}`),n(!1),i()}catch(f){console.error("Error updating subscription:",f),_.error(f.message||"Erreur lors de la mise à jour du plan")}finally{d(!1)}};return e.jsx(ce,{open:r,onOpenChange:n,children:e.jsxs(de,{children:[e.jsxs(ue,{children:[e.jsx(me,{children:"Modifier le plan d'abonnement"}),e.jsxs(pe,{children:["Changer le plan pour ",o]})]}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{children:"Plan actuel"}),e.jsx("div",{className:"px-3 py-2 bg-muted rounded-md",children:e.jsx("span",{className:"font-semibold capitalize",children:s})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"new_plan",children:"Nouveau plan *"}),e.jsxs(be,{value:u,onValueChange:l=>h(l),children:[e.jsx(Ce,{children:e.jsx(Ne,{placeholder:"Sélectionner un nouveau plan"})}),e.jsxs(Me,{children:[e.jsx($,{value:"starter",children:"Starter - Fonctionnalités de base"}),e.jsx($,{value:"pro",children:"Pro - Analytics + Promotions"}),e.jsx($,{value:"premium",children:"Premium - Multi-restaurants + IA"})]})]})]}),e.jsxs(Ee,{children:[e.jsx(I,{type:"button",variant:"outline",onClick:()=>n(!1),disabled:c,children:"Annuler"}),e.jsx(I,{type:"submit",disabled:c||u===s,children:c?"Mise à jour...":"Confirmer"})]})]})]})})}function Zt({open:r,onOpenChange:n,userId:t,userEmail:s}){const[o,i]=a.useState(!1),[c,d]=a.useState(!1),[u,h]=a.useState(""),[g,l]=a.useState(""),[f,v]=a.useState([]),[w,M]=a.useState(!1),[N,S]=a.useState(!0);a.useEffect(()=>{r&&t&&(D(),h(""),l(""))},[r,t]);const D=async()=>{M(!0);try{const{data:m,error:j}=await b.from("admin_impersonation_tokens").select("*").eq("target_user_id",t).eq("revoked",!1).gt("expires_at",new Date().toISOString()).order("created_at",{ascending:!1});if(j)throw j;const E=(m||[]).filter(U=>!U.used||U.single_use===!1);v(E)}catch(m){console.error("Error fetching tokens:",m)}finally{M(!1)}},T=async()=>{i(!0);try{const{data:{session:m}}=await b.auth.getSession();if(!m){_.error("Session expirée");return}const{data:j,error:E}=await b.functions.invoke("admin-generate-login-link",{body:{user_id:t,user_email:s,single_use:N},headers:{Authorization:`Bearer ${m.access_token}`}});if(E)throw E;j!=null&&j.url?(h(j.url),l(j.expires_at),_.success("Lien de connexion généré"),D()):j!=null&&j.error&&_.error(j.error)}catch(m){console.error("Error generating link:",m),_.error(m.message||"Erreur lors de la génération")}finally{i(!1)}},Z=async()=>{try{await navigator.clipboard.writeText(u),_.success("Lien copié !")}catch{_.error("Erreur lors de la copie")}},Q=async m=>{d(!0);try{const{data:{session:j}}=await b.auth.getSession();if(!j){_.error("Session expirée");return}const{error:E}=await b.functions.invoke("admin-revoke-login-link",{body:{token_id:m},headers:{Authorization:`Bearer ${j.access_token}`}});if(E)throw E;_.success("Lien révoqué"),D(),u.includes(m)&&(h(""),l(""))}catch(j){console.error("Error revoking link:",j),_.error(j.message||"Erreur lors de la révocation")}finally{d(!1)}},J=async()=>{d(!0);try{const{data:{session:m}}=await b.auth.getSession();if(!m){_.error("Session expirée");return}const{data:j,error:E}=await b.functions.invoke("admin-revoke-login-link",{body:{user_id:t},headers:{Authorization:`Bearer ${m.access_token}`}});if(E)throw E;_.success((j==null?void 0:j.message)||"Liens révoqués"),v([]),h(""),l("")}catch(m){console.error("Error revoking all links:",m),_.error(m.message||"Erreur lors de la révocation")}finally{d(!1)}},G=m=>new Date(m).toLocaleString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsx(ce,{open:r,onOpenChange:n,children:e.jsxs(de,{className:"max-w-lg",children:[e.jsxs(ue,{children:[e.jsxs(me,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5"}),"Lien de connexion"]}),e.jsxs(pe,{children:["Générer un lien de connexion pour ",e.jsx("strong",{children:s}),e.jsx("br",{}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Le lien sera valide 24h et à usage unique. Aucun email ne sera envoyé."})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(L,{htmlFor:"single-use",className:"text-sm font-medium",children:"Usage unique"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:N?"Le lien ne fonctionnera qu'une seule fois":"Le lien sera valide 24h avec usages illimités"})]}),e.jsx(Nt,{id:"single-use",checked:N,onCheckedChange:S})]}),e.jsx(I,{onClick:T,disabled:o,className:"w-full",children:o?e.jsxs(e.Fragment,{children:[e.jsx(ir,{className:"h-4 w-4 mr-2 animate-spin"}),"Génération..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Générer un nouveau lien"]})}),u&&e.jsxs("div",{className:"space-y-2 p-4 bg-muted/50 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{value:u,readOnly:!0,className:"font-mono text-xs"}),e.jsx(I,{size:"icon",variant:"outline",onClick:Z,children:e.jsx(Pt,{className:"h-4 w-4"})}),e.jsx(I,{size:"icon",variant:"outline",onClick:()=>window.open(u,"_blank"),children:e.jsx(kt,{className:"h-4 w-4"})})]}),g&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Expire le : ",G(g)]})]}),w?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(ir,{className:"h-5 w-5 animate-spin text-muted-foreground"})}):f.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium",children:["Liens actifs (",f.length,")"]}),e.jsxs(I,{variant:"ghost",size:"sm",onClick:J,disabled:c,className:"text-destructive hover:text-destructive",children:[e.jsx(Be,{className:"h-4 w-4 mr-1"}),"Révoquer tous"]})]}),e.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:f.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-muted/30 rounded text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(oe,{variant:"outline",children:"Actif"}),m.single_use===!1&&e.jsx(oe,{variant:"secondary",children:"Multi-usage"}),e.jsxs("span",{className:"text-muted-foreground",children:["Expire : ",G(m.expires_at)]})]}),e.jsx(I,{size:"sm",variant:"ghost",onClick:()=>Q(m.token),disabled:c,children:e.jsx(Be,{className:"h-3 w-3"})})]},m.id))})]})]})]})})}function Qt(r){const n=Jt(r),t=a.forwardRef((s,o)=>{const{children:i,...c}=s,d=a.Children.toArray(i),u=d.find(rn);if(u){const h=u.props.children,g=d.map(l=>l===u?a.Children.count(h)>1?a.Children.only(null):a.isValidElement(h)?h.props.children:null:l);return e.jsx(n,{...c,ref:o,children:a.isValidElement(h)?a.cloneElement(h,void 0,g):null})}return e.jsx(n,{...c,ref:o,children:i})});return t.displayName=`${r}.Slot`,t}function Jt(r){const n=a.forwardRef((t,s)=>{const{children:o,...i}=t;if(a.isValidElement(o)){const c=nn(o),d=tn(i,o.props);return o.type!==a.Fragment&&(d.ref=s?ze(s,c):c),a.cloneElement(o,d)}return a.Children.count(o)>1?a.Children.only(null):null});return n.displayName=`${r}.SlotClone`,n}var en=Symbol("radix.slottable");function rn(r){return a.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===en}function tn(r,n){const t={...n};for(const s in n){const o=r[s],i=n[s];/^on[A-Z]/.test(s)?o&&i?t[s]=(...d)=>{const u=i(...d);return o(...d),u}:o&&(t[s]=o):s==="style"?t[s]={...o,...i}:s==="className"&&(t[s]=[o,i].filter(Boolean).join(" "))}return{...r,...t}}function nn(r){var s,o;let n=(s=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:s.get,t=n&&"isReactWarning"in n&&n.isReactWarning;return t?r.ref:(n=(o=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:o.get,t=n&&"isReactWarning"in n&&n.isReactWarning,t?r.props.ref:r.props.ref||r.ref)}var Ue=["Enter"," "],sn=["ArrowDown","PageUp","Home"],fr=["ArrowUp","PageDown","End"],an=[...sn,...fr],on={ltr:[...Ue,"ArrowRight"],rtl:[...Ue,"ArrowLeft"]},ln={ltr:["ArrowLeft"],rtl:["ArrowRight"]},he="Menu",[ie,cn,dn]=ct(he),[Y,hr]=cr(he,[dn,dr,pr]),Pe=dr(),xr=pr(),[un,X]=Y(he),[mn,xe]=Y(he),gr=r=>{const{__scopeMenu:n,open:t=!1,children:s,dir:o,onOpenChange:i,modal:c=!0}=r,d=Pe(n),[u,h]=a.useState(null),g=a.useRef(!1),l=ur(i),f=Lt(o);return a.useEffect(()=>{const v=()=>{g.current=!0,document.addEventListener("pointerdown",w,{capture:!0,once:!0}),document.addEventListener("pointermove",w,{capture:!0,once:!0})},w=()=>g.current=!1;return document.addEventListener("keydown",v,{capture:!0}),()=>{document.removeEventListener("keydown",v,{capture:!0}),document.removeEventListener("pointerdown",w,{capture:!0}),document.removeEventListener("pointermove",w,{capture:!0})}},[]),e.jsx(dt,{...d,children:e.jsx(un,{scope:n,open:t,onOpenChange:l,content:u,onContentChange:h,children:e.jsx(mn,{scope:n,onClose:a.useCallback(()=>l(!1),[l]),isUsingKeyboardRef:g,dir:f,modal:c,children:s})})})};gr.displayName=he;var pn="MenuAnchor",He=a.forwardRef((r,n)=>{const{__scopeMenu:t,...s}=r,o=Pe(t);return e.jsx(ut,{...o,...s,ref:n})});He.displayName=pn;var We="MenuPortal",[fn,vr]=Y(We,{forceMount:void 0}),jr=r=>{const{__scopeMenu:n,forceMount:t,children:s,container:o}=r,i=X(We,n);return e.jsx(fn,{scope:n,forceMount:t,children:e.jsx(De,{present:t||i.open,children:e.jsx(mt,{asChild:!0,container:o,children:s})})})};jr.displayName=We;var O="MenuContent",[hn,Ye]=Y(O),wr=a.forwardRef((r,n)=>{const t=vr(O,r.__scopeMenu),{forceMount:s=t.forceMount,...o}=r,i=X(O,r.__scopeMenu),c=xe(O,r.__scopeMenu);return e.jsx(ie.Provider,{scope:r.__scopeMenu,children:e.jsx(De,{present:s||i.open,children:e.jsx(ie.Slot,{scope:r.__scopeMenu,children:c.modal?e.jsx(xn,{...o,ref:n}):e.jsx(gn,{...o,ref:n})})})})}),xn=a.forwardRef((r,n)=>{const t=X(O,r.__scopeMenu),s=a.useRef(null),o=fe(n,s);return a.useEffect(()=>{const i=s.current;if(i)return pt(i)},[]),e.jsx(Xe,{...r,ref:o,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:C(r.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),gn=a.forwardRef((r,n)=>{const t=X(O,r.__scopeMenu);return e.jsx(Xe,{...r,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),vn=Qt("MenuContent.ScrollLock"),Xe=a.forwardRef((r,n)=>{const{__scopeMenu:t,loop:s=!1,trapFocus:o,onOpenAutoFocus:i,onCloseAutoFocus:c,disableOutsidePointerEvents:d,onEntryFocus:u,onEscapeKeyDown:h,onPointerDownOutside:g,onFocusOutside:l,onInteractOutside:f,onDismiss:v,disableOutsideScroll:w,...M}=r,N=X(O,t),S=xe(O,t),D=Pe(t),T=xr(t),Z=cn(t),[Q,J]=a.useState(null),G=a.useRef(null),m=fe(n,G,N.onContentChange),j=a.useRef(0),E=a.useRef(""),U=a.useRef(0),F=a.useRef(null),ge=a.useRef("right"),ne=a.useRef(0),Ae=w?xt:a.Fragment,Te=w?{as:vn,allowPinchZoom:!0}:void 0,Le=p=>{var ee,rr;const y=E.current+p,R=Z().filter(K=>!K.disabled),k=document.activeElement,H=(ee=R.find(K=>K.ref.current===k))==null?void 0:ee.textValue,Oe=R.map(K=>K.textValue),er=Dn(Oe,y,H),se=(rr=R.find(K=>K.textValue===er))==null?void 0:rr.ref.current;(function K(tr){E.current=tr,window.clearTimeout(j.current),tr!==""&&(j.current=window.setTimeout(()=>K(""),1e3))})(y),se&&setTimeout(()=>se.focus())};a.useEffect(()=>()=>window.clearTimeout(j.current),[]),ht();const x=a.useCallback(p=>{var R,k;return ge.current===((R=F.current)==null?void 0:R.side)&&kn(p,(k=F.current)==null?void 0:k.area)},[]);return e.jsx(hn,{scope:t,searchRef:E,onItemEnter:a.useCallback(p=>{x(p)&&p.preventDefault()},[x]),onItemLeave:a.useCallback(p=>{var y;x(p)||((y=G.current)==null||y.focus(),J(null))},[x]),onTriggerLeave:a.useCallback(p=>{x(p)&&p.preventDefault()},[x]),pointerGraceTimerRef:U,onPointerGraceIntentChange:a.useCallback(p=>{F.current=p},[]),children:e.jsx(Ae,{...Te,children:e.jsx(gt,{asChild:!0,trapped:o,onMountAutoFocus:C(i,p=>{var y;p.preventDefault(),(y=G.current)==null||y.focus({preventScroll:!0})}),onUnmountAutoFocus:c,children:e.jsx(vt,{asChild:!0,disableOutsidePointerEvents:d,onEscapeKeyDown:h,onPointerDownOutside:g,onFocusOutside:l,onInteractOutside:f,onDismiss:v,children:e.jsx(Ft,{asChild:!0,...T,dir:S.dir,orientation:"vertical",loop:s,currentTabStopId:Q,onCurrentTabStopIdChange:J,onEntryFocus:C(u,p=>{S.isUsingKeyboardRef.current||p.preventDefault()}),preventScrollOnEntryFocus:!0,children:e.jsx(jt,{role:"menu","aria-orientation":"vertical","data-state":Lr(N.open),"data-radix-menu-content":"",dir:S.dir,...D,...M,ref:m,style:{outline:"none",...M.style},onKeyDown:C(M.onKeyDown,p=>{const R=p.target.closest("[data-radix-menu-content]")===p.currentTarget,k=p.ctrlKey||p.altKey||p.metaKey,H=p.key.length===1;R&&(p.key==="Tab"&&p.preventDefault(),!k&&H&&Le(p.key));const Oe=G.current;if(p.target!==Oe||!an.includes(p.key))return;p.preventDefault();const se=Z().filter(ee=>!ee.disabled).map(ee=>ee.ref.current);fr.includes(p.key)&&se.reverse(),Rn(se)}),onBlur:C(r.onBlur,p=>{p.currentTarget.contains(p.target)||(window.clearTimeout(j.current),E.current="")}),onPointerMove:C(r.onPointerMove,le(p=>{const y=p.target,R=ne.current!==p.clientX;if(p.currentTarget.contains(y)&&R){const k=p.clientX>ne.current?"right":"left";ge.current=k,ne.current=p.clientX}}))})})})})})})});wr.displayName=O;var jn="MenuGroup",Ze=a.forwardRef((r,n)=>{const{__scopeMenu:t,...s}=r;return e.jsx(te.div,{role:"group",...s,ref:n})});Ze.displayName=jn;var wn="MenuLabel",_r=a.forwardRef((r,n)=>{const{__scopeMenu:t,...s}=r;return e.jsx(te.div,{...s,ref:n})});_r.displayName=wn;var Se="MenuItem",lr="menu.itemSelect",ke=a.forwardRef((r,n)=>{const{disabled:t=!1,onSelect:s,...o}=r,i=a.useRef(null),c=xe(Se,r.__scopeMenu),d=Ye(Se,r.__scopeMenu),u=fe(n,i),h=a.useRef(!1),g=()=>{const l=i.current;if(!t&&l){const f=new CustomEvent(lr,{bubbles:!0,cancelable:!0});l.addEventListener(lr,v=>s==null?void 0:s(v),{once:!0}),ft(l,f),f.defaultPrevented?h.current=!1:c.onClose()}};return e.jsx(yr,{...o,ref:u,disabled:t,onClick:C(r.onClick,g),onPointerDown:l=>{var f;(f=r.onPointerDown)==null||f.call(r,l),h.current=!0},onPointerUp:C(r.onPointerUp,l=>{var f;h.current||(f=l.currentTarget)==null||f.click()}),onKeyDown:C(r.onKeyDown,l=>{const f=d.searchRef.current!=="";t||f&&l.key===" "||Ue.includes(l.key)&&(l.currentTarget.click(),l.preventDefault())})})});ke.displayName=Se;var yr=a.forwardRef((r,n)=>{const{__scopeMenu:t,disabled:s=!1,textValue:o,...i}=r,c=Ye(Se,t),d=xr(t),u=a.useRef(null),h=fe(n,u),[g,l]=a.useState(!1),[f,v]=a.useState("");return a.useEffect(()=>{const w=u.current;w&&v((w.textContent??"").trim())},[i.children]),e.jsx(ie.ItemSlot,{scope:t,disabled:s,textValue:o??f,children:e.jsx(Ot,{asChild:!0,...d,focusable:!s,children:e.jsx(te.div,{role:"menuitem","data-highlighted":g?"":void 0,"aria-disabled":s||void 0,"data-disabled":s?"":void 0,...i,ref:h,onPointerMove:C(r.onPointerMove,le(w=>{s?c.onItemLeave(w):(c.onItemEnter(w),w.defaultPrevented||w.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:C(r.onPointerLeave,le(w=>c.onItemLeave(w))),onFocus:C(r.onFocus,()=>l(!0)),onBlur:C(r.onBlur,()=>l(!1))})})})}),_n="MenuCheckboxItem",br=a.forwardRef((r,n)=>{const{checked:t=!1,onCheckedChange:s,...o}=r;return e.jsx(Rr,{scope:r.__scopeMenu,checked:t,children:e.jsx(ke,{role:"menuitemcheckbox","aria-checked":Re(t)?"mixed":t,...o,ref:n,"data-state":Je(t),onSelect:C(o.onSelect,()=>s==null?void 0:s(Re(t)?!0:!t),{checkForDefaultPrevented:!1})})})});br.displayName=_n;var Cr="MenuRadioGroup",[yn,bn]=Y(Cr,{value:void 0,onValueChange:()=>{}}),Nr=a.forwardRef((r,n)=>{const{value:t,onValueChange:s,...o}=r,i=ur(s);return e.jsx(yn,{scope:r.__scopeMenu,value:t,onValueChange:i,children:e.jsx(Ze,{...o,ref:n})})});Nr.displayName=Cr;var Mr="MenuRadioItem",Sr=a.forwardRef((r,n)=>{const{value:t,...s}=r,o=bn(Mr,r.__scopeMenu),i=t===o.value;return e.jsx(Rr,{scope:r.__scopeMenu,checked:i,children:e.jsx(ke,{role:"menuitemradio","aria-checked":i,...s,ref:n,"data-state":Je(i),onSelect:C(s.onSelect,()=>{var c;return(c=o.onValueChange)==null?void 0:c.call(o,t)},{checkForDefaultPrevented:!1})})})});Sr.displayName=Mr;var Qe="MenuItemIndicator",[Rr,Cn]=Y(Qe,{checked:!1}),Er=a.forwardRef((r,n)=>{const{__scopeMenu:t,forceMount:s,...o}=r,i=Cn(Qe,t);return e.jsx(De,{present:s||Re(i.checked)||i.checked===!0,children:e.jsx(te.span,{...o,ref:n,"data-state":Je(i.checked)})})});Er.displayName=Qe;var Nn="MenuSeparator",Dr=a.forwardRef((r,n)=>{const{__scopeMenu:t,...s}=r;return e.jsx(te.div,{role:"separator","aria-orientation":"horizontal",...s,ref:n})});Dr.displayName=Nn;var Mn="MenuArrow",Pr=a.forwardRef((r,n)=>{const{__scopeMenu:t,...s}=r,o=Pe(t);return e.jsx(wt,{...o,...s,ref:n})});Pr.displayName=Mn;var Sn="MenuSub",[qs,kr]=Y(Sn),ae="MenuSubTrigger",Ir=a.forwardRef((r,n)=>{const t=X(ae,r.__scopeMenu),s=xe(ae,r.__scopeMenu),o=kr(ae,r.__scopeMenu),i=Ye(ae,r.__scopeMenu),c=a.useRef(null),{pointerGraceTimerRef:d,onPointerGraceIntentChange:u}=i,h={__scopeMenu:r.__scopeMenu},g=a.useCallback(()=>{c.current&&window.clearTimeout(c.current),c.current=null},[]);return a.useEffect(()=>g,[g]),a.useEffect(()=>{const l=d.current;return()=>{window.clearTimeout(l),u(null)}},[d,u]),e.jsx(He,{asChild:!0,...h,children:e.jsx(yr,{id:o.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":o.contentId,"data-state":Lr(t.open),...r,ref:ze(n,o.onTriggerChange),onClick:l=>{var f;(f=r.onClick)==null||f.call(r,l),!(r.disabled||l.defaultPrevented)&&(l.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:C(r.onPointerMove,le(l=>{i.onItemEnter(l),!l.defaultPrevented&&!r.disabled&&!t.open&&!c.current&&(i.onPointerGraceIntentChange(null),c.current=window.setTimeout(()=>{t.onOpenChange(!0),g()},100))})),onPointerLeave:C(r.onPointerLeave,le(l=>{var v,w;g();const f=(v=t.content)==null?void 0:v.getBoundingClientRect();if(f){const M=(w=t.content)==null?void 0:w.dataset.side,N=M==="right",S=N?-5:5,D=f[N?"left":"right"],T=f[N?"right":"left"];i.onPointerGraceIntentChange({area:[{x:l.clientX+S,y:l.clientY},{x:D,y:f.top},{x:T,y:f.top},{x:T,y:f.bottom},{x:D,y:f.bottom}],side:M}),window.clearTimeout(d.current),d.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(l),l.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:C(r.onKeyDown,l=>{var v;const f=i.searchRef.current!=="";r.disabled||f&&l.key===" "||on[s.dir].includes(l.key)&&(t.onOpenChange(!0),(v=t.content)==null||v.focus(),l.preventDefault())})})})});Ir.displayName=ae;var Ar="MenuSubContent",Tr=a.forwardRef((r,n)=>{const t=vr(O,r.__scopeMenu),{forceMount:s=t.forceMount,...o}=r,i=X(O,r.__scopeMenu),c=xe(O,r.__scopeMenu),d=kr(Ar,r.__scopeMenu),u=a.useRef(null),h=fe(n,u);return e.jsx(ie.Provider,{scope:r.__scopeMenu,children:e.jsx(De,{present:s||i.open,children:e.jsx(ie.Slot,{scope:r.__scopeMenu,children:e.jsx(Xe,{id:d.contentId,"aria-labelledby":d.triggerId,...o,ref:h,align:"start",side:c.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:g=>{var l;c.isUsingKeyboardRef.current&&((l=u.current)==null||l.focus()),g.preventDefault()},onCloseAutoFocus:g=>g.preventDefault(),onFocusOutside:C(r.onFocusOutside,g=>{g.target!==d.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:C(r.onEscapeKeyDown,g=>{c.onClose(),g.preventDefault()}),onKeyDown:C(r.onKeyDown,g=>{var v;const l=g.currentTarget.contains(g.target),f=ln[c.dir].includes(g.key);l&&f&&(i.onOpenChange(!1),(v=d.trigger)==null||v.focus(),g.preventDefault())})})})})})});Tr.displayName=Ar;function Lr(r){return r?"open":"closed"}function Re(r){return r==="indeterminate"}function Je(r){return Re(r)?"indeterminate":r?"checked":"unchecked"}function Rn(r){const n=document.activeElement;for(const t of r)if(t===n||(t.focus(),document.activeElement!==n))return}function En(r,n){return r.map((t,s)=>r[(n+s)%r.length])}function Dn(r,n,t){const o=n.length>1&&Array.from(n).every(h=>h===n[0])?n[0]:n,i=t?r.indexOf(t):-1;let c=En(r,Math.max(i,0));o.length===1&&(c=c.filter(h=>h!==t));const u=c.find(h=>h.toLowerCase().startsWith(o.toLowerCase()));return u!==t?u:void 0}function Pn(r,n){const{x:t,y:s}=r;let o=!1;for(let i=0,c=n.length-1;i<n.length;c=i++){const d=n[i],u=n[c],h=d.x,g=d.y,l=u.x,f=u.y;g>s!=f>s&&t<(l-h)*(s-g)/(f-g)+h&&(o=!o)}return o}function kn(r,n){if(!n)return!1;const t={x:r.clientX,y:r.clientY};return Pn(t,n)}function le(r){return n=>n.pointerType==="mouse"?r(n):void 0}var In=gr,An=He,Tn=jr,Ln=wr,On=Ze,Fn=_r,$n=ke,Gn=br,Bn=Nr,Un=Sr,Kn=Er,zn=Dr,Vn=Pr,qn=Ir,Hn=Tr,Ie="DropdownMenu",[Wn]=cr(Ie,[hr]),A=hr(),[Yn,Or]=Wn(Ie),Fr=r=>{const{__scopeDropdownMenu:n,children:t,dir:s,open:o,defaultOpen:i,onOpenChange:c,modal:d=!0}=r,u=A(n),h=a.useRef(null),[g,l]=_t({prop:o,defaultProp:i??!1,onChange:c,caller:Ie});return e.jsx(Yn,{scope:n,triggerId:nr(),triggerRef:h,contentId:nr(),open:g,onOpenChange:l,onOpenToggle:a.useCallback(()=>l(f=>!f),[l]),modal:d,children:e.jsx(In,{...u,open:g,onOpenChange:l,dir:s,modal:d,children:t})})};Fr.displayName=Ie;var $r="DropdownMenuTrigger",Gr=a.forwardRef((r,n)=>{const{__scopeDropdownMenu:t,disabled:s=!1,...o}=r,i=Or($r,t),c=A(t);return e.jsx(An,{asChild:!0,...c,children:e.jsx(te.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":s?"":void 0,disabled:s,...o,ref:ze(n,i.triggerRef),onPointerDown:C(r.onPointerDown,d=>{!s&&d.button===0&&d.ctrlKey===!1&&(i.onOpenToggle(),i.open||d.preventDefault())}),onKeyDown:C(r.onKeyDown,d=>{s||(["Enter"," "].includes(d.key)&&i.onOpenToggle(),d.key==="ArrowDown"&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(d.key)&&d.preventDefault())})})})});Gr.displayName=$r;var Xn="DropdownMenuPortal",Br=r=>{const{__scopeDropdownMenu:n,...t}=r,s=A(n);return e.jsx(Tn,{...s,...t})};Br.displayName=Xn;var Ur="DropdownMenuContent",Kr=a.forwardRef((r,n)=>{const{__scopeDropdownMenu:t,...s}=r,o=Or(Ur,t),i=A(t),c=a.useRef(!1);return e.jsx(Ln,{id:o.contentId,"aria-labelledby":o.triggerId,...i,...s,ref:n,onCloseAutoFocus:C(r.onCloseAutoFocus,d=>{var u;c.current||(u=o.triggerRef.current)==null||u.focus(),c.current=!1,d.preventDefault()}),onInteractOutside:C(r.onInteractOutside,d=>{const u=d.detail.originalEvent,h=u.button===0&&u.ctrlKey===!0,g=u.button===2||h;(!o.modal||g)&&(c.current=!0)}),style:{...r.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Kr.displayName=Ur;var Zn="DropdownMenuGroup",Qn=a.forwardRef((r,n)=>{const{__scopeDropdownMenu:t,...s}=r,o=A(t);return e.jsx(On,{...o,...s,ref:n})});Qn.displayName=Zn;var Jn="DropdownMenuLabel",zr=a.forwardRef((r,n)=>{const{__scopeDropdownMenu:t,...s}=r,o=A(t);return e.jsx(Fn,{...o,...s,ref:n})});zr.displayName=Jn;var es="DropdownMenuItem",Vr=a.forwardRef((r,n)=>{const{__scopeDropdownMenu:t,...s}=r,o=A(t);return e.jsx($n,{...o,...s,ref:n})});Vr.displayName=es;var rs="DropdownMenuCheckboxItem",qr=a.forwardRef((r,n)=>{const{__scopeDropdownMenu:t,...s}=r,o=A(t);return e.jsx(Gn,{...o,...s,ref:n})});qr.displayName=rs;var ts="DropdownMenuRadioGroup",ns=a.forwardRef((r,n)=>{const{__scopeDropdownMenu:t,...s}=r,o=A(t);return e.jsx(Bn,{...o,...s,ref:n})});ns.displayName=ts;var ss="DropdownMenuRadioItem",Hr=a.forwardRef((r,n)=>{const{__scopeDropdownMenu:t,...s}=r,o=A(t);return e.jsx(Un,{...o,...s,ref:n})});Hr.displayName=ss;var as="DropdownMenuItemIndicator",Wr=a.forwardRef((r,n)=>{const{__scopeDropdownMenu:t,...s}=r,o=A(t);return e.jsx(Kn,{...o,...s,ref:n})});Wr.displayName=as;var os="DropdownMenuSeparator",Yr=a.forwardRef((r,n)=>{const{__scopeDropdownMenu:t,...s}=r,o=A(t);return e.jsx(zn,{...o,...s,ref:n})});Yr.displayName=os;var is="DropdownMenuArrow",ls=a.forwardRef((r,n)=>{const{__scopeDropdownMenu:t,...s}=r,o=A(t);return e.jsx(Vn,{...o,...s,ref:n})});ls.displayName=is;var cs="DropdownMenuSubTrigger",Xr=a.forwardRef((r,n)=>{const{__scopeDropdownMenu:t,...s}=r,o=A(t);return e.jsx(qn,{...o,...s,ref:n})});Xr.displayName=cs;var ds="DropdownMenuSubContent",Zr=a.forwardRef((r,n)=>{const{__scopeDropdownMenu:t,...s}=r,o=A(t);return e.jsx(Hn,{...o,...s,ref:n,style:{...r.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Zr.displayName=ds;var us=Fr,ms=Gr,ps=Br,Qr=Kr,Jr=zr,et=Vr,rt=qr,tt=Hr,nt=Wr,st=Yr,at=Xr,ot=Zr;const fs=us,hs=ms,xs=a.forwardRef(({className:r,inset:n,children:t,...s},o)=>e.jsxs(at,{ref:o,className:V("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",n&&"pl-8",r),...s,children:[t,e.jsx(yt,{className:"ml-auto h-4 w-4"})]}));xs.displayName=at.displayName;const gs=a.forwardRef(({className:r,...n},t)=>e.jsx(ot,{ref:t,className:V("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...n}));gs.displayName=ot.displayName;const it=a.forwardRef(({className:r,sideOffset:n=4,...t},s)=>e.jsx(ps,{children:e.jsx(Qr,{ref:s,sideOffset:n,className:V("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...t})}));it.displayName=Qr.displayName;const z=a.forwardRef(({className:r,inset:n,...t},s)=>e.jsx(et,{ref:s,className:V("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n&&"pl-8",r),...t}));z.displayName=et.displayName;const vs=a.forwardRef(({className:r,children:n,checked:t,...s},o)=>e.jsxs(rt,{ref:o,className:V("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),checked:t,...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(nt,{children:e.jsx($t,{className:"h-4 w-4"})})}),n]}));vs.displayName=rt.displayName;const js=a.forwardRef(({className:r,children:n,...t},s)=>e.jsxs(tt,{ref:s,className:V("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...t,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(nt,{children:e.jsx(Mt,{className:"h-2 w-2 fill-current"})})}),n]}));js.displayName=tt.displayName;const lt=a.forwardRef(({className:r,inset:n,...t},s)=>e.jsx(Jr,{ref:s,className:V("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",r),...t}));lt.displayName=Jr.displayName;const Ke=a.forwardRef(({className:r,...n},t)=>e.jsx(st,{ref:t,className:V("-mx-1 my-1 h-px bg-muted",r),...n}));Ke.displayName=st.displayName;function Hs(){const[r,n]=a.useState([]),[t,s]=a.useState([]),[o,i]=a.useState(!0),[c,d]=a.useState(""),[u,h]=a.useState("all"),[g,l]=a.useState(!1),[f,v]=a.useState(!1),[w,M]=a.useState(!1),[N,S]=a.useState(!1),[D,T]=a.useState(!1),[Z,Q]=a.useState(!1),[J,G]=a.useState(!1),[m,j]=a.useState(null),[E,U]=a.useState(!1);a.useEffect(()=>{F()},[]),a.useEffect(()=>{ge()},[r,c,u]);const F=async()=>{try{const{data:x,error:p}=await b.from("profiles").select("*").order("created_at",{ascending:!1});if(p)throw p;const y=await Promise.all((x||[]).map(async R=>{const{data:k}=await b.from("user_roles").select("role").eq("user_id",R.user_id).single(),{data:H}=await b.from("user_subscriptions").select("plan").eq("user_id",R.user_id).single();return{...R,role:(k==null?void 0:k.role)||"user",plan:(H==null?void 0:H.plan)||"starter"}}));n(y)}catch(x){console.error("Error fetching users:",x),_.error("Erreur lors du chargement des utilisateurs")}finally{i(!1)}},ge=()=>{let x=[...r];c&&(x=x.filter(p=>{var y,R;return p.email.toLowerCase().includes(c.toLowerCase())||((y=p.first_name)==null?void 0:y.toLowerCase().includes(c.toLowerCase()))||((R=p.last_name)==null?void 0:R.toLowerCase().includes(c.toLowerCase()))})),u!=="all"&&(x=x.filter(p=>p.role===u)),s(x)},ne=async(x,p)=>{try{const{data:{session:y}}=await b.auth.getSession();if(!y){_.error("Session expirée, veuillez vous reconnecter");return}const{data:R,error:k}=await b.functions.invoke("admin-change-role",{body:{user_id:x,new_role:p},headers:{Authorization:`Bearer ${y.access_token}`}});if(k)throw k;_.success(R.message||"Rôle modifié avec succès"),F()}catch(y){console.error("Error changing role:",y),_.error(y.message||"Erreur lors du changement de rôle")}},Ae=async()=>{if(m){U(!0);try{const{data:{session:x}}=await b.auth.getSession(),{error:p}=await b.functions.invoke("admin-delete-user",{body:{user_id:m.user_id},headers:{Authorization:`Bearer ${x==null?void 0:x.access_token}`}});if(p)throw p;_.success("Utilisateur supprimé avec succès"),S(!1),F()}catch(x){_.error(x.message||"Erreur lors de la suppression")}finally{U(!1)}}},Te=async x=>{if(m){U(!0);try{const{data:{session:p}}=await b.auth.getSession(),{error:y}=await b.functions.invoke("admin-toggle-block",{body:{user_id:m.user_id,action:x,reason:"Bloqué par administrateur"},headers:{Authorization:`Bearer ${p==null?void 0:p.access_token}`}});if(y)throw y;_.success(x==="block"?"Utilisateur bloqué":"Utilisateur débloqué"),T(!1),F()}catch(p){_.error(p.message||"Erreur")}finally{U(!1)}}},Le=x=>x==="admin"?e.jsxs(oe,{variant:"default",className:"bg-purple-500",children:[e.jsx(Ct,{className:"h-3 w-3 mr-1"}),"Admin"]}):e.jsx(oe,{variant:"secondary",children:"Utilisateur"});return o?e.jsx("div",{className:"p-8",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/4"}),e.jsx("div",{className:"h-64 bg-muted rounded"})]})}):e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Gestion des Utilisateurs"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Gérer les comptes utilisateurs et leurs permissions"})]}),e.jsxs(I,{onClick:()=>l(!0),children:[e.jsx(Gt,{className:"h-4 w-4 mr-2"}),"Créer un utilisateur"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(ve,{children:[e.jsx(je,{className:"pb-2",children:e.jsx(we,{className:"text-sm font-medium",children:"Total Utilisateurs"})}),e.jsx(_e,{children:e.jsx("div",{className:"text-2xl font-bold",children:r.length})})]}),e.jsxs(ve,{children:[e.jsx(je,{className:"pb-2",children:e.jsx(we,{className:"text-sm font-medium",children:"Administrateurs"})}),e.jsx(_e,{children:e.jsx("div",{className:"text-2xl font-bold",children:r.filter(x=>x.role==="admin").length})})]}),e.jsxs(ve,{children:[e.jsx(je,{className:"pb-2",children:e.jsx(we,{className:"text-sm font-medium",children:"Utilisateurs Standard"})}),e.jsx(_e,{children:e.jsx("div",{className:"text-2xl font-bold",children:r.filter(x=>x.role==="user").length})})]})]}),e.jsxs(ve,{children:[e.jsxs(je,{children:[e.jsx(we,{children:"Liste des Utilisateurs"}),e.jsx(bt,{children:"Recherchez et gérez les utilisateurs de la plateforme"})]}),e.jsxs(_e,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Bt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Rechercher par email ou nom...",value:c,onChange:x=>d(x.target.value),className:"pl-10"})]}),e.jsxs(be,{value:u,onValueChange:h,children:[e.jsx(Ce,{className:"w-full md:w-[200px]",children:e.jsx(Ne,{placeholder:"Filtrer par rôle"})}),e.jsxs(Me,{children:[e.jsx($,{value:"all",children:"Tous les rôles"}),e.jsx($,{value:"admin",children:"Administrateurs"}),e.jsx($,{value:"user",children:"Utilisateurs"})]})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(It,{children:[e.jsx(At,{children:e.jsxs(Fe,{children:[e.jsx(re,{children:"Utilisateur"}),e.jsx(re,{children:"Email"}),e.jsx(re,{children:"Rôle"}),e.jsx(re,{children:"Date d'inscription"}),e.jsx(re,{children:"Plan"}),e.jsx(re,{className:"text-right",children:"Actions"})]})}),e.jsx(Tt,{children:t.length===0?e.jsx(Fe,{children:e.jsx(W,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"Aucun utilisateur trouvé"})}):t.map(x=>e.jsxs(Fe,{children:[e.jsx(W,{className:"font-medium",children:x.first_name||x.last_name?`${x.first_name||""} ${x.last_name||""}`.trim():"Non renseigné"}),e.jsx(W,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ut,{className:"h-4 w-4 text-muted-foreground"}),x.email]})}),e.jsx(W,{children:Le(x.role)}),e.jsx(W,{children:e.jsx(oe,{variant:"outline",className:x.plan==="premium"?"border-purple-500 text-purple-500":x.plan==="pro"?"border-blue-500 text-blue-500":"border-gray-500 text-gray-500",children:x.plan.charAt(0).toUpperCase()+x.plan.slice(1)})}),e.jsx(W,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Kt,{className:"h-4 w-4 text-muted-foreground"}),new Date(x.created_at).toLocaleDateString("fr-FR")]})}),e.jsx(W,{className:"text-right",children:e.jsxs(fs,{children:[e.jsx(hs,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",children:e.jsx(St,{className:"h-4 w-4"})})}),e.jsxs(it,{align:"end",children:[e.jsx(lt,{children:"Actions"}),e.jsx(Ke,{}),e.jsxs(z,{onClick:()=>{j(x),v(!0)},children:[e.jsx(Rt,{className:"h-4 w-4 mr-2"}),"Éditer le profil"]}),e.jsxs(z,{onClick:()=>ne(x.user_id,x.role==="admin"?"user":"admin"),children:[e.jsx(or,{className:"h-4 w-4 mr-2"}),"Changer en ",x.role==="admin"?"Utilisateur":"Admin"]}),e.jsxs(z,{onClick:()=>{j(x),Q(!0)},children:[e.jsx(or,{className:"h-4 w-4 mr-2"}),"Changer le plan"]}),e.jsxs(z,{onClick:()=>{j(x),M(!0)},children:[e.jsx(Et,{className:"h-4 w-4 mr-2"}),"Réinitialiser le mot de passe"]}),e.jsxs(z,{onClick:()=>{j(x),G(!0)},children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"Générer lien de connexion"]}),e.jsx(Ke,{}),e.jsxs(z,{onClick:()=>{j(x),T(!0)},children:[e.jsx(Dt,{className:"h-4 w-4 mr-2"}),"Bloquer/Débloquer"]}),e.jsxs(z,{onClick:()=>{j(x),S(!0)},className:"text-destructive",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Supprimer l'utilisateur"]})]})]})})]},x.id))})]})})]})]}),e.jsx(Ht,{open:g,onOpenChange:l,onSuccess:F}),e.jsx(Wt,{open:f,onOpenChange:v,profile:m,onSuccess:F}),e.jsx(Yt,{open:w,onOpenChange:M,userId:(m==null?void 0:m.user_id)||null,userEmail:(m==null?void 0:m.email)||null}),e.jsx(ar,{open:N,onOpenChange:S,title:"Supprimer l'utilisateur",description:`Êtes-vous sûr de vouloir supprimer ${m==null?void 0:m.email} ? Cette action est irréversible.`,onConfirm:Ae,loading:E,variant:"destructive"}),e.jsx(ar,{open:D,onOpenChange:T,title:"Bloquer/Débloquer l'utilisateur",description:`Voulez-vous bloquer ${m==null?void 0:m.email} ?`,onConfirm:()=>Te("block"),loading:E}),e.jsx(Xt,{open:Z,onOpenChange:Q,userId:(m==null?void 0:m.user_id)||"",currentPlan:(m==null?void 0:m.plan)||"starter",userEmail:(m==null?void 0:m.email)||"",onSuccess:F}),e.jsx(Zt,{open:J,onOpenChange:G,userId:(m==null?void 0:m.user_id)||"",userEmail:(m==null?void 0:m.email)||""})]})}export{Hs as default};
