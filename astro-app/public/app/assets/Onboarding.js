import{j as e,I as j,R as B,d as E,F as L,r as m,B as v,M as D,s as A,k as O,u as P,b2 as V,v as _,A as q}from"./index.js";import{u as M}from"./useRestaurantSettings.js";import{u as $}from"./useOnboardingProgress.js";import{L as g}from"./label.js";import{A as U,W as H}from"./WhatsAppOnboardingButton.js";import{u as J}from"./useWhatsAppIntegration.js";import{C}from"./circle-check-big.js";import{L as X}from"./loader-circle.js";import{u as Q}from"./useCatalogue.js";import{C as Y}from"./CatalogueCreator.js";import{P as k}from"./plus.js";import{U as G}from"./upload.js";import{C as K,S as Z}from"./shopping-bag.js";import{S as ee}from"./store.js";import{C as se}from"./clock.js";import{F as te}from"./file-text.js";import{C as ae}from"./check.js";import{A as re}from"./arrow-left.js";import"./useQuery.js";import"./search.js";import"./popover.js";import"./map-pin.js";import"./circle-alert.js";import"./textarea.js";import"./switch.js";import"./index5.js";import"./scroll-area.js";import"./index3.js";import"./index4.js";import"./trash-2.js";const le=({data:t,onChange:i})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Bienvenue sur ChatFood !"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Commençons par les informations de base de votre restaurant."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"restaurant_name",children:"Nom du restaurant *"}),e.jsx(j,{id:"restaurant_name",placeholder:"Ex: Le Petit Bistrot",value:t.restaurant_name,onChange:s=>i({restaurant_name:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"address_street",children:"Adresse"}),e.jsx(U,{id:"address_street",value:t.address_street,onChange:s=>i({address_street:s}),onAddressSelect:s=>i({address_street:s.street,address_postal_code:s.postalCode,address_city:s.city,longitude:s.longitude,latitude:s.latitude})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"address_postal_code",children:"Code postal"}),e.jsx(j,{id:"address_postal_code",placeholder:"75001",value:t.address_postal_code,onChange:s=>i({address_postal_code:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"address_city",children:"Ville"}),e.jsx(j,{id:"address_city",placeholder:"Paris",value:t.address_city,onChange:s=>i({address_city:s.target.value})})]})]})]})]}),I=["lundi","mardi","mercredi","jeudi","vendredi","samedi","dimanche"],ne=({data:t,onChange:i})=>{const s=(a,c,l)=>{const n=[...t];n[a]={...n[a],[c]:l},i(n)};return B.useEffect(()=>{(!t||t.length===0)&&i(I.map(a=>({day:a,slot1:"",slot2:""})))},[t,i]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Horaires d'ouverture"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Indiquez vos horaires pour chaque jour de la semaine."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-[100px_1fr_1fr] gap-3 text-sm font-medium text-muted-foreground mb-2",children:[e.jsx("span",{children:"Jour"}),e.jsx("span",{children:"Matin / Midi"}),e.jsx("span",{children:"Soir"})]}),((t==null?void 0:t.length)>0?t:I.map(a=>({day:a,slot1:"",slot2:""}))).map((a,c)=>e.jsxs("div",{className:"grid grid-cols-[100px_1fr_1fr] gap-3 items-center",children:[e.jsx(g,{className:"capitalize font-medium",children:a.day}),e.jsx(j,{placeholder:"Ex: 12h-14h30",value:a.slot1,onChange:l=>s(c,"slot1",l.target.value)}),e.jsx(j,{placeholder:"Ex: 19h-22h",value:a.slot2,onChange:l=>s(c,"slot2",l.target.value)})]},a.day))]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Laissez vide les jours où vous êtes fermé."})]})},ie=()=>{const{user:t}=E(),{toast:i}=L(),{integration:s,isLoading:a,refetch:c}=J(),l=(s==null?void 0:s.status)==="active",[n,r]=m.useState(!1),h=async()=>{if(t!=null&&t.id){r(!0);try{await A.from("whatsapp_integrations").update({status:"inactive"}).eq("user_id",t.id),await A.from("restaurant_settings").update({chatbot_active:!1}).eq("user_id",t.id),c(),i({title:"WhatsApp déconnecté"})}catch{i({title:"Erreur",description:"Impossible de déconnecter WhatsApp.",variant:"destructive"})}finally{r(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Connexion WhatsApp"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Connectez votre compte WhatsApp Business pour recevoir les commandes."})]}),e.jsx("div",{className:"flex flex-col items-center justify-center py-8",children:a?e.jsx("div",{className:"animate-pulse h-12 w-48 bg-muted rounded-lg"}):l?e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600",children:[e.jsx(C,{className:"h-8 w-8"}),e.jsx("span",{className:"text-lg font-medium",children:"WhatsApp connecté !"})]}),e.jsx("p",{className:"text-muted-foreground",children:(s==null?void 0:s.display_phone_number)||(s==null?void 0:s.verified_name)||"Votre compte WhatsApp Business est prêt."}),e.jsxs(v,{variant:"outline",size:"sm",onClick:h,disabled:n,className:"text-destructive hover:text-destructive",children:[n&&e.jsx(X,{className:"mr-2 h-4 w-4 animate-spin"}),"Déconnecter"]})]}):e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center mx-auto",children:e.jsx(D,{className:"h-10 w-10 text-green-600"})}),e.jsx(H,{}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:"Vous pouvez aussi passer cette étape et configurer WhatsApp plus tard dans les paramètres."})]})})]})},ce=()=>{const{items:t,isLoading:i}=Q(),[s,a]=m.useState(!1),c=t&&t.length>0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Votre catalogue"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Créez votre carte pour permettre à vos clients de commander."})]}),e.jsx("div",{className:"flex flex-col items-center justify-center py-8",children:i?e.jsx("div",{className:"animate-pulse h-12 w-48 bg-muted rounded-lg"}):c?e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-600",children:[e.jsx(C,{className:"h-8 w-8"}),e.jsx("span",{className:"text-lg font-medium",children:"Catalogue créé !"})]}),e.jsxs("p",{className:"text-muted-foreground",children:[t.length," produit",t.length>1?"s":""," dans votre catalogue"]}),e.jsxs(v,{variant:"outline",onClick:()=>a(!0),children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Ajouter d'autres produits"]})]}):e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center mx-auto",children:e.jsx(G,{className:"h-10 w-10 text-primary"})}),e.jsx("div",{className:"space-y-3",children:e.jsxs(v,{onClick:()=>a(!0),size:"lg",children:[e.jsx(k,{className:"h-5 w-5 mr-2"}),"Créer mon catalogue"]})}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:"Vous pouvez aussi passer cette étape et créer votre catalogue plus tard."})]})}),e.jsx(Y,{open:s,onOpenChange:a})]})},oe=({data:t,onChange:i})=>{const s=(t==null?void 0:t.replace(/\s/g,""))||"",a=s.length===14&&/^\d+$/.test(s),[c,l]=m.useState(!1),[n,r]=m.useState(null),[h,p]=m.useState(null),f=m.useRef(null),N=async x=>{if(x.length!==14||!/^\d{14}$/.test(x)){r(null),p(null);return}l(!0);try{const d=await(await fetch("https://n8n.chatfood.fr/webhook/check-siret-0b2e9a5584c0",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siret:x})})).json();Array.isArray(d)&&d.length>0&&d[0].existe===!0?(r(!0),p(d[0].nom_commercial||d[0].adresse_complete||null)):(r(!1),p(null))}catch(o){console.error("SIRET validation error:",o),r(!1),p(null)}finally{l(!1)}};m.useEffect(()=>(f.current&&clearTimeout(f.current),a?f.current=setTimeout(()=>{N(s)},500):(r(null),p(null)),()=>{f.current&&clearTimeout(f.current)}),[s,a]);const b=x=>{const o=x.replace(/\D/g,"").slice(0,14),d=[];return o.length>0&&d.push(o.slice(0,3)),o.length>3&&d.push(o.slice(3,6)),o.length>6&&d.push(o.slice(6,9)),o.length>9&&d.push(o.slice(9,14)),d.join(" ")},y=x=>{const o=b(x.target.value);i(o)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Numéro SIRET"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Dernière étape ! Votre numéro SIRET pour la facturation."})]}),e.jsx("div",{className:"flex flex-col items-center justify-center py-8",children:e.jsxs("div",{className:"w-full max-w-sm space-y-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-6",children:e.jsx(O,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"siret",children:"Numéro SIRET (14 chiffres)"}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{id:"siret",placeholder:"XXX XXX XXX XXXXX",value:t||"",onChange:y,className:`pr-10 ${n===!0?"border-green-500":n===!1?"border-destructive":""}`}),c&&e.jsx(X,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground animate-spin"}),!c&&n===!0&&e.jsx(C,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-green-500"}),!c&&n===!1&&e.jsx(K,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 text-destructive"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.length,"/14 chiffres"]}),n===!0&&h&&e.jsx("p",{className:"text-sm text-green-600 font-medium",children:h}),n===!1&&a&&e.jsx("p",{className:"text-sm text-destructive",children:"SIRET non trouvé ou invalide"})]}),e.jsx("p",{className:"text-sm text-muted-foreground text-center mt-6",children:"Ce champ est optionnel. Vous pourrez le renseigner plus tard dans les paramètres."})]})})]})},Oe=()=>{const t=P(),[i,s]=V(),{user:a,loading:c}=E(),{settings:l,updateSettings:n}=M(a==null?void 0:a.id);$(a==null?void 0:a.id),m.useEffect(()=>{!c&&!a&&t("/login")},[a,c,t]);const r=parseInt(i.get("step")||"1"),[h,p]=m.useState({restaurant_name:"",address_street:"",address_postal_code:"",address_city:"",longitude:null,latitude:null}),[f,N]=m.useState([]),[b,y]=m.useState(""),[x,o]=m.useState(!1);m.useEffect(()=>{l&&(p({restaurant_name:l.restaurant_name||"",address_street:l.address_street||"",address_postal_code:l.address_postal_code||"",address_city:l.address_city||"",longitude:l.longitude||null,latitude:l.latitude||null}),N(l.opening_hours||[]),y(l.siret||""))},[l]);const d=u=>{s({step:u.toString()})},R=async()=>{o(!0);try{r===1?await n(h):r===2?await n({opening_hours:f}):r===5&&await n({siret:b}),r<5?d(r+1):(await n({onboarding_completed:!0}),t("/dashboard"))}catch(u){console.error("Error saving step:",u)}finally{o(!1)}},F=()=>{r>1&&d(r-1)},T=async()=>{r<5?d(r+1):(await n({onboarding_completed:!0}),t("/dashboard"))},z=[{id:1,icon:ee,label:"Restaurant"},{id:2,icon:se,label:"Horaires"},{id:3,icon:D,label:"WhatsApp"},{id:4,icon:Z,label:"Menu"},{id:5,icon:te,label:"Légal"}];return c||!a?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})}):e.jsxs("div",{className:"min-h-screen flex bg-background",children:[e.jsxs("div",{className:"hidden lg:flex w-1/3 bg-primary/5 border-r flex-col p-8 justify-between relative overflow-hidden",children:[e.jsxs("div",{className:"z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-12",children:[e.jsx("div",{className:"h-8 w-8 bg-primary rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-primary-foreground font-bold",children:"C"})}),e.jsx("span",{className:"text-xl font-bold",children:"ChatFood"})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Configurons votre restaurant"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Quelques étapes simples pour propulser votre activité sur WhatsApp."})]}),e.jsx("div",{className:"space-y-4",children:z.map(u=>{const W=u.icon,w=u.id===r,S=u.id<r;return e.jsxs("div",{className:_("flex items-center gap-4 p-3 rounded-lg transition-all duration-200",w?"bg-background shadow-sm border":"opacity-60"),children:[e.jsx("div",{className:_("h-10 w-10 rounded-full flex items-center justify-center transition-colors",w?"bg-primary text-primary-foreground":S?"bg-green-500 text-white":"bg-muted text-muted-foreground"),children:S?e.jsx(ae,{className:"h-5 w-5"}):e.jsx(W,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:_("font-medium",w&&"text-primary"),children:u.label}),w&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"En cours..."})]})]},u.id)})})]})]}),e.jsx("div",{className:"absolute top-0 right-0 -mt-20 -mr-20 w-96 h-96 bg-primary/10 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-0 -mb-20 -ml-20 w-96 h-96 bg-blue-500/10 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"lg:hidden p-4 border-b flex items-center justify-between bg-background",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 bg-primary rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-primary-foreground font-bold",children:"C"})}),e.jsx("span",{className:"font-bold",children:"ChatFood"})]}),e.jsxs("div",{className:"text-sm font-medium",children:["Étape ",r,"/5"]})]}),e.jsx("div",{className:"lg:hidden w-full bg-muted h-1",children:e.jsx("div",{className:"bg-primary h-1 transition-all duration-300",style:{width:`${r/5*100}%`}})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"max-w-2xl mx-auto p-6 lg:p-12",children:[e.jsx("div",{className:"mb-8",children:e.jsxs(v,{variant:"ghost",size:"sm",className:"mb-4 pl-0 hover:pl-2 transition-all",onClick:F,disabled:r===1,children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Retour"]})}),e.jsxs("div",{className:"min-h-[400px]",children:[r===1&&e.jsx(le,{data:h,onChange:u=>p({...h,...u})}),r===2&&e.jsx(ne,{data:f,onChange:N}),r===3&&e.jsx(ie,{}),r===4&&e.jsx(ce,{}),r===5&&e.jsx(oe,{data:b,onChange:y})]})]})}),e.jsx("div",{className:"border-t p-6 bg-background/50 backdrop-blur-sm sticky bottom-0",children:e.jsxs("div",{className:"max-w-2xl mx-auto flex items-center justify-between",children:[e.jsx(v,{variant:"ghost",onClick:T,className:"text-muted-foreground",children:"Passer cette étape"}),e.jsx(v,{onClick:R,disabled:x,className:"min-w-[120px]",children:x?"Sauvegarde...":r===5?"Terminer":e.jsxs(e.Fragment,{children:["Suivant",e.jsx(q,{className:"ml-2 h-4 w-4"})]})})]})})]})]})};export{Oe as default};
